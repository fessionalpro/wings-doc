import{_ as o,X as p,Y as i,$ as n,a1 as a,a0 as e,a3 as t,C as l}from"./framework-a66c2b6a.js";const c={},r=t(`<h1 id="_0e-配置话题" tabindex="-1"><a class="header-anchor" href="#_0e-配置话题" aria-hidden="true">#</a> 0E.配置话题</h1><p>工程配置，如maven，properties，spring等设置项。</p><h2 id="_0e-01-哪些参数是必须打开的" tabindex="-1"><a class="header-anchor" href="#_0e-01-哪些参数是必须打开的" aria-hidden="true">#</a> 0E.01.哪些参数是必须打开的</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 找到所有开关文件</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">&#39;spring-wings-enabled.properties&#39;</span> <span class="token punctuation">\\</span>
<span class="token operator">|</span> <span class="token function">egrep</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;target/|example/&#39;</span> 

./slardar/src/main/resources/wings-conf/spring-wings-enabled.properties
./faceless/src/main/resources/wings-conf/spring-wings-enabled.properties
./silencer/src/main/resources/wings-conf/spring-wings-enabled.properties

<span class="token comment"># 找到所有false的开关</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">&#39;spring-wings-enabled.properties&#39;</span> <span class="token punctuation">\\</span>
<span class="token operator">|</span> <span class="token function">egrep</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;target/|example/&#39;</span> <span class="token punctuation">\\</span>
<span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> <span class="token string">&#39;false&#39;</span>

<span class="token comment"># 以下2个需要在flywave和enum时开启</span>
<span class="token assign-left variable">spring.wings.faceless.flywave.enabled.module</span><span class="token operator">=</span>false
<span class="token assign-left variable">spring.wings.faceless.enabled.enumi18n</span><span class="token operator">=</span>false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_0e-02-调整springboot版本和依赖" tabindex="-1"><a class="header-anchor" href="#_0e-02-调整springboot版本和依赖" aria-hidden="true">#</a> 0E.02.调整springboot版本和依赖</h2><p>wings仅在SpringBoot标准生命周期中，对配置文件的加载，进行了处理，不依赖于任何特定版本。 对于不想跟随wings一同升级spring及其依赖的，只把wings做dependency，而不parent和import即可。</p><p>wings随时跟进升级SpringBoot的次一级稳定版，目的是为了测试sharding-jdbc和jooq的兼容性。 而在二进制兼容方面，wings210版本的编译的目标是java=11，kotlin=1.6</p><p>对于maven继承依赖有parent和import两种，其重要区别在于property覆盖。</p>`,8),u=n("li",null,"parent - you can also override individual dependencies by overriding a property in your own project",-1),d=n("li",null,"import - does not let you override individual dependencies by using properties, as explained above. To achieve the same result, you need to add entries in the dependencyManagement section of your project before the spring-boot-dependencies entry.",-1),g={href:"https://docs.spring.io/spring-boot/docs/3.0.3/maven-plugin/reference/htmlsingle/#using.parent-pom",target:"_blank",rel:"noopener noreferrer"},k={href:"https://docs.spring.io/spring-boot/docs/3.0.3/maven-plugin/reference/htmlsingle/#using-import",target:"_blank",rel:"noopener noreferrer"},m=t(`<p>对于低于wings的spring-boot版本，一般来讲指定一下jooq版本就可以完全正常。</p><h2 id="_0e-03-lib工程和boot工程的区别" tabindex="-1"><a class="header-anchor" href="#_0e-03-lib工程和boot工程的区别" aria-hidden="true">#</a> 0E.03.lib工程和boot工程的区别</h2><p>SpringBoot打包的executable是boot.jar 不是普通的lib.jar</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>lib工程的配置，跳过<code>repackage</code>，参考example之外的工程</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>wings推荐的工程结构是，parent的pom.xml的<code>project/build/plugins</code>项， 对以下<code>plugin</code>的<code>configuration</code>进行默认设置，</p><ul><li>spring-boot-maven-plugin - executable=true</li><li>maven-deploy-plugin - skip=true</li><li>maven-install-plugin - skip=true</li></ul><p>这样，所有子模块，以boot工程提供默认的build（boot打包，不deploy，不install）。 在lib子模块中跳过boot打包，即repackage中skip=true</p><h2 id="_0e-04-缺少mirana和meepo依赖lib" tabindex="-1"><a class="header-anchor" href="#_0e-04-缺少mirana和meepo依赖lib" aria-hidden="true">#</a> 0E.04.缺少mirana和meepo依赖lib</h2><p>因是非吃货的大翅项目（曾用名），一些<code>SNAPSHOT</code>依赖，需要自行编译并本地安装。 偶尔可以在<code>sonatype</code>上找到，需要自行添加<code>repository</code>，如<code>~/.m2/settings.xml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>ossrh-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://oss.sonatype.org/content/repositories/snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_0e-05-配置和注入时的占位符" tabindex="-1"><a class="header-anchor" href="#_0e-05-配置和注入时的占位符" aria-hidden="true">#</a> 0E.05.配置和注入时的占位符</h2><ul><li>硬编码中，@Autowired <ul><li>PropertyResolver - 以key获取或解析value字符串</li><li>StringValueResolver - 解析value字符串</li></ul></li><li>properties配置中<code>\${VAR}</code></li><li>@Value和@RequestMapping中<code>\${VAR}</code></li></ul><h2 id="_0e-06-移除tomcat或hazelcast" tabindex="-1"><a class="header-anchor" href="#_0e-06-移除tomcat或hazelcast" aria-hidden="true">#</a> 0E.06.移除Tomcat或hazelcast</h2><p>使用wings为parent时通过dependencyManagement，继承wings默认不需要修改。 但若是没有继承wings依赖，以下2项视情况需要自行调整。</p><ul><li>spring-boot-starter-web/spring-boot-starter-tomcat，因默认使用undertow</li><li>spring-session-hazelcast/hazelcast，使用最新版本</li></ul><h2 id="_0e-07-java和kotlin版本" tabindex="-1"><a class="header-anchor" href="#_0e-07-java和kotlin版本" aria-hidden="true">#</a> 0E.07.Java和Kotlin版本</h2><p>通过pom设置java和kotlin的编译版本，若IDE中出现编译失败，很可能是编译版本不对。 从210起，wings全面适配java 11，kotlin自动更新为1.6，但未做java8证兼性测试。</p><h2 id="_0e-08-如何配置logger和log-groups" tabindex="-1"><a class="header-anchor" href="#_0e-08-如何配置logger和log-groups" aria-hidden="true">#</a> 0E.08.如何配置logger和log groups</h2>`,20),v={href:"https://docs.spring.io/spring-boot/docs/3.0.3/reference/htmlsingle/#features.logging.log-groups",target:"_blank",rel:"noopener noreferrer"},b=n("li",null,"org.springframework.core.codec",-1),h=n("li",null,"org.springframework.http",-1),f={href:"http://org.springframework.web",target:"_blank",rel:"noopener noreferrer"},_={href:"http://org.springframework.boot.actuate.endpoint.web",target:"_blank",rel:"noopener noreferrer"},x=n("li",null,"org.springframework.boot.web.servlet.ServletContextInitializerBeans",-1),w=n("li",null,"org.springframework.jdbc.core",-1),y=n("li",null,"org.jooq.tools.LoggerListener",-1),E=t(`<blockquote><p>Spring Boot uses Commons Logging for all internal logging but leaves the underlying log implementation open</p></blockquote><p>Wings遵循这一实践，<code>@Configuration</code>等spring功能为CommonsLogging， 而业务代码中使用lombok的<code>@Slf4j</code>配置为<code>static</code> <code>log</code></p><h2 id="_0e-09-mvn-resources-filtering" tabindex="-1"><a class="header-anchor" href="#_0e-09-mvn-resources-filtering" aria-hidden="true">#</a> 0E.09.mvn resources filtering</h2><p>注：在210版后，以spring变量取代了mvn变量，不再需要filter。</p><p>因为在swagger的配置中使用了变量<code>@project.version@</code>，所以会配置 build/resources/resource/filtering=true，以便mvn自动替换。</p><p>但是开启filter会引起错误替换，比如二进制文件等，wings默认忽略一些二进制文件</p><h2 id="_0e-10-spa及反向代理的缓存设置" tabindex="-1"><a class="header-anchor" href="#_0e-10-spa及反向代理的缓存设置" aria-hidden="true">#</a> 0E.10.SPA及反向代理的缓存设置</h2><p>默认情况下springboot自动增加以下Response Header，使得反向代理无需设置 <code>Cache-Control</code>=<code>no-cache,no-store,max-age=0,must-revalidate</code></p><p>但对于SPA页面，需要进行手动设置，如nginx配置。</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token comment">#add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;; #允许跨域</span>
    <span class="token directive"><span class="token keyword">root</span> /data/static/demo-admin-spa/</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_filename</span> ~* \\.(html|htm)$)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control no-cache,no-store,max-age=0,must-revalidate</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_0e-11-如何忽略一个配置项" tabindex="-1"><a class="header-anchor" href="#_0e-11-如何忽略一个配置项" aria-hidden="true">#</a> 0E.11.如何忽略一个配置项</h2><p>wings原则上，所以配置项都必有默认配置，而有时候需要忽略一些默认key或value。</p><ul><li><code>String</code>无效值 - <code>空</code>或<code>-</code>是默认的无效值</li><li><code>Map&lt;String, String&gt;</code> - 无效值key的value</li><li><code>Map&lt;String, Set&lt;String&gt;&gt;</code> - 被覆盖的key的value</li></ul><h2 id="_0e-12-spring中的执行顺序" tabindex="-1"><a class="header-anchor" href="#_0e-12-spring中的执行顺序" aria-hidden="true">#</a> 0E.12.Spring中的执行顺序</h2><p>在Spring生命周期中，以@Configuration为例，存在以下顺序执行</p><ul><li>Constructor - 构造函数优先执行</li><li>@Autowired - 依赖注入</li><li>@PostConstruct - 依赖注入后执行，无参数</li><li>afterPropertiesSet - InitializingBean接口</li><li>@Bean - 按需或按顺序执行</li><li>ApplicationStartedEvent - Started，事件参数</li><li>CommandLineRunner - Runner，注入依赖</li><li>ApplicationReadyEvent - Ready，事件参数</li></ul><p>Wings中常用的配置方式及顺序如下，</p><ul><li>Constructor - 全局的，必须的依赖，以final构造注入</li><li>@Autowired - 局部的，选用的依赖，以setter注入</li><li>@PostConstruct - 执行当前配置的收尾，无参数的</li><li>ApplicationStartedEventRunner - before app/cmd runners 初始化Helper</li><li>ApplicationRunnerOrdered - 自定义ordered的ApplicationRunner</li><li>CommandLineRunnerOrdered - 自定义ordered的CommandLineRunner</li><li>ApplicationInspectRunner - LOWEST_PRECEDENCE ApplicationRunner</li><li>ApplicationReadyEventRunner - after app/cmd runners called</li></ul><p>Helper会在ApplicationStartedEvent时初始化。Configuration和常用Bean由常量定义</p><ul><li>WingsBeanNaming - 重要bean的name</li><li>WingsBeanOrdered - Order及层叠</li></ul><h2 id="_0e-13-spring配置中的日志格式" tabindex="-1"><a class="header-anchor" href="#_0e-13-spring配置中的日志格式" aria-hidden="true">#</a> 0E.13.Spring配置中的日志格式</h2><p>在Configuration的CommonsLogging中，日志遵循以下通用的log.info格式</p><ul><li><code>@Bean</code> - {ModuleName} spring-bean {BeanName}</li><li><code>@Autowired</code> - {ModuleName} spring-auto {MethodName}</li><li><code>@PostConstruct</code> - {ModuleName} spring-auto {MethodName}</li><li><code>CommandLineRunner</code> - {ModuleName} spring-runs {BeanName}</li><li><code>Bean*PostProcessor</code> - {ModuleName} spring-proc {BeanName}</li><li>过程日志 - {ModuleName} conf</li></ul>`,23);function S(C,R){const s=l("ExternalLinkIcon");return p(),i("div",null,[r,n("ul",null,[u,d,n("li",null,[n("a",g,[a("https://docs.spring.io/spring-boot/docs/3.0.3/maven-plugin/reference/htmlsingle/#using.parent-pom"),e(s)])]),n("li",null,[n("a",k,[a("https://docs.spring.io/spring-boot/docs/3.0.3/maven-plugin/reference/htmlsingle/#using-import"),e(s)])])]),m,n("p",null,[a("SpringBoot内置以下"),n("a",v,[a("Log Groups"),e(s)])]),n("ul",null,[b,h,n("li",null,[n("a",f,[a("org.springframework.web"),e(s)])]),n("li",null,[n("a",_,[a("org.springframework.boot.actuate.endpoint.web"),e(s)])]),x,w,y]),E])}const B=o(c,[["render",S],["__file","0e-qa-config.html.vue"]]);export{B as default};
