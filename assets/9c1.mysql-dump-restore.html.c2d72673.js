import{_ as d}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as o,b as e,e as r,d as t,f as c,r as i}from"./app.626c9445.js";const n={},l=e("h1",{id:"_9c1-备份及恢复mysql",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_9c1-备份及恢复mysql","aria-hidden":"true"},"#"),r(" 9C1.备份及恢复mysql")],-1),h=e("p",null,"适用于 mysql 5.7/8.0，native/cloud数据库。适用mysqldump备份，适用mysql恢复",-1),p=e("h2",{id:"_9c1-1-备份时事项",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_9c1-1-备份时事项","aria-hidden":"true"},"#"),r(" 9C1.1.备份时事项")],-1),_={href:"http://wings-mysql-dump.sh",target:"_blank",rel:"noopener noreferrer"},m=c('<p>根据dump文件中的txt文件进行 scp，gzip 操作。</p><h2 id="_9c1-2-恢复时事项" tabindex="-1"><a class="header-anchor" href="#_9c1-2-恢复时事项" aria-hidden="true">#</a> 9C1.2.恢复时事项</h2><p>使用mysqldump的备份时，在trigger时，需要调整其中的DEFINER <code>sed -E &#39;s/DEFINER=[^*]+//g&#39;</code></p><p>使用mysqlpump的备份时，需要注意sql中的原database限定，避免错库。 <code>sed -E &#39;s/</code>OLD_DB<code>/</code>NEW_DB<code>/g&#39;</code></p><h2 id="_9c1-3-已知问题" tabindex="-1"><a class="header-anchor" href="#_9c1-3-已知问题" aria-hidden="true">#</a> 9C1.3.已知问题</h2><p>云数据库的root，通常没有SHUTDOWN和SUPER权限，甚至更多，以避免破坏配置。</p><h3 id="_01-error-1227-the-super-privilege" tabindex="-1"><a class="header-anchor" href="#_01-error-1227-the-super-privilege" aria-hidden="true">#</a> 01.<code>ERROR 1227: the SUPER privilege</code></h3><p>在wings体系内，恢复trigger时，因导出语句有<code>DEFINER=</code>，估提示权限不足。 需要设置trigger权限，并满足以下条件之一或全部。</p><ul><li>mysql导入时，按dump中的tip执行，或手工执行sed替换</li><li>服务器端 <code>log_bin_trust_function_creators = 1</code>，提示SUPER权限</li></ul><h3 id="_02-error-1071-max-key-length-is-767" tabindex="-1"><a class="header-anchor" href="#_02-error-1071-max-key-length-is-767" aria-hidden="true">#</a> 02.<code>ERROR 1071: max key length is 767</code></h3><p>服务器端设置 <code>innodb_large_prefix = 1</code> 但某些云默认配置关闭了此选项。 可以通过控制台提交参数修改，无需重启。以下是字符集及char,byte的知识点。</p><ul><li>UTF-8MB4 - 767/4=191</li><li>UTF-8MB4 - 767/3=255</li><li>打开后，从 767 扩展到 3072 bytes</li></ul>',12);function u(g,f){const a=i("ExternalLinkIcon");return s(),o("div",null,[l,h,p,e("p",null,[r("使用 "),e("a",_,[r("wings-mysql-dump.sh"),t(a)]),r(" 脚本进行备份，选择wings.dba权限即可。 若使用 mysqlpump，注意是pump不是dump，需要额外的权限。")]),m])}const E=d(n,[["render",u],["__file","9c1.mysql-dump-restore.html.vue"]]);export{E as default};
