import{_ as o,Y as i,Z as l,a0 as e,a2 as n,a1 as s,a4 as t,C as r}from"./framework-3a8f5b7b.js";const c={},p=t(`<h1 id="_3a-jackson-convention" tabindex="-1"><a class="header-anchor" href="#_3a-jackson-convention" aria-hidden="true">#</a> 3A.Jackson Convention</h1><p>Conversion of common data types in Mvc server.</p><h2 id="_3a-1-common-type-conventions" tabindex="-1"><a class="header-anchor" href="#_3a-1-common-type-conventions" aria-hidden="true">#</a> 3A.1.Common Type Conventions</h2><p>Given the differences between java and js, data transfer, and functionality, the convention is as follows.</p><ul><li>float number to java.BigDecimal and js.string to pass each other</li><li>java.null not to pass each other in Json</li><li>java.integer, interpass with js.number/string</li><li>java.datetime, including <code>util.Date</code>,<code>sql.Date</code>,<code>time.Local*|Zoned*|Instant</code></li><li>java.datetime, in timestamp format with js.number</li><li>java.datetime, in <code>yyyy-MM-dd HH:mm:ss</code> format with js.string</li><li>java.timezone, both in ZoneId string format with js.string</li></ul><h2 id="_3a-2-lost-precision-and-trait" tabindex="-1"><a class="header-anchor" href="#_3a-2-lost-precision-and-trait" aria-hidden="true">#</a> 3A.2.Lost Precision and Trait</h2><p>Because of the character of js, there will be precision and character (type, sorting, etc.) loss problems, such as the key of object may lose the original order.</p><ul><li>It is better to have only 2 basic data types in Json: boolean and string</li><li>Js does not handle numeric calculations with precision, and should only be responsible for displaying the results of server-side calculations.</li><li>Due to the special nature of time, there are timezones and daylight saving time, readability is preferred when guaranteeing accuracy</li><li>53bits of long, must use string, because IEE754 cannot be correctly represented</li><li>integer and long, use number by default, consider typescript compatibility</li><li>Ensure jsr310 format compatibility, e.g. rely on <code>jackson-datatype-jsr310</code></li><li>ZoneId should prefer <code>IANA TZDB</code> format, e.g. <code>America/New_York</code></li><li>Serialization and deserialization process with time zone (<code>Z</code>) will lose daylight saving time information</li></ul><p>Note: The property name prefix cannot be a single letter, Wings recommends more than 3 letters. Because <code>sCount</code> will lead to parsing errors, see test OkHttpClientHelperTest.testPostBad</p><h2 id="_3a-3-i18n-of-content" tabindex="-1"><a class="header-anchor" href="#_3a-3-i18n-of-content" aria-hidden="true">#</a> 3A.3.I18n of Content</h2><p>Auto I18n conversion of content by annotation and type to string output.</p><ul><li><code>I18nString</code> type is automatically converted</li><li><code>CharSequence</code> with <code>@JsonI18nString</code> annotation is converted as message_code</li><li><code>@JsonI18nString(false)</code> disables auto-conversion</li><li><code>R.I&lt;T&gt;</code> is the common return type and will auto replace <code>message</code> with i18n when <code>i18nCode</code> is present, Auto-conversion uses the injected <code>messageSource</code> and <code>WingsI18nContext</code> to get the appropriate language</li></ul><h2 id="_3a-4-datetime-format" tabindex="-1"><a class="header-anchor" href="#_3a-4-datetime-format" aria-hidden="true">#</a> 3A.4.DateTime Format</h2><p>Supports the following date format customizations in java.time, including Json and Spring.</p><ul><li>LocalDate, LocalTime, LocalDateTime, multiple input formats, single output format customization.</li><li>ZonedDateTime, same as <code>Local*</code> support auto-switching to user timezone, off by default.</li><li>OffsetDateTime, same as \`Local* support auto-switching to user timezone, on by default</li></ul><p>For example, the default configuration of wings-datetime-79.properties in the LocalDate support,</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># output in 2021-01-30 format</span>
<span class="token key attr-name">wings.slardar.datetime.date.format</span><span class="token punctuation">=</span><span class="token value attr-value">yyyy[-MM][-dd]</span>
<span class="token comment"># input support 2021-01-30 and Jan/30/2021, etc.</span>
<span class="token key attr-name">wings.slardar.datetime.date.parser</span><span class="token punctuation">=</span><span class="token value attr-value">\\
,yyyy[-][/][.][M][-][/][.][d]\\
,[MMMM][MMM][M][-][/][.][d][-][/][.][yyyy][yy]</span>
<span class="token comment"># see SmartFormatter.java testcase</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3a-5-number-format" tabindex="-1"><a class="header-anchor" href="#_3a-5-number-format" aria-hidden="true">#</a> 3A.5.Number Format</h2><p>Int,Long,Float,Double,BigDecimal support (Json) customization of output format and rounding format. Note that in the actual project, Float and Double should be avoided and BigDecimal should be used. Within Wings convention, the only commonly Number types should be Int, Long and BigDecimal.</p><p>For example, the default configuration of Decimal support in wings-number-79.properties is,</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># Keep 2 decimal places, Floor mode</span>
<span class="token key attr-name">wings.slardar.number.decimal.format</span><span class="token punctuation">=</span><span class="token value attr-value">#.00</span>
<span class="token key attr-name">wings.slardar.number.decimal.round</span><span class="token punctuation">=</span><span class="token value attr-value">FLOOR</span>
<span class="token key attr-name">wings.slardar.number.decimal.separator</span><span class="token punctuation">=</span><span class="token value attr-value">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also set, according to Chinese custom, every 4 digits separated by <code>_</code>, add CNY symbol,</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">wings.slardar.number.decimal.format</span><span class="token punctuation">=</span><span class="token value attr-value">￥,####.00</span>
<span class="token key attr-name">wings.slardar.number.decimal.separator</span><span class="token punctuation">=</span><span class="token value attr-value">_</span>
<span class="token comment"># see DecimalFormatTest.java</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>digital=auto</code> auto switches between number and string when the JS numeric value exceeds Number.M##_SAFE_INTEGER. By default configuration, <code>auto</code> is used only for int32 and int64, need to be used with caution, check type or disable <code>auto</code>(<code>false</code>)</p><h2 id="_3a-6-empty-data-handling" tabindex="-1"><a class="header-anchor" href="#_3a-6-empty-data-handling" aria-hidden="true">#</a> 3A.6.Empty Data Handling</h2><p>This feature is enabled by default and will cause inconsistencies in the serialization and deserialization. Must handle the difference yourself.</p><ul><li>Empty date is considered null, not output to avoid a lot of 1000-01-01 data</li><li>Array/Collection/Map is not output if it is empty</li></ul><h2 id="_3a-7-common-jackson-annotations" tabindex="-1"><a class="header-anchor" href="#_3a-7-common-jackson-annotations" aria-hidden="true">#</a> 3A.7.Common Jackson Annotations</h2><ul><li>@JsonRawValue - number不变字符串，字符串不转义</li><li>@JsonFormat - 指定格式</li><li>@JsonIgnore/JsonProperty - 忽略该字段</li><li>@JsonProperty - 重命名</li><li>@JsonNaming - 命名规则</li><li>@JsonRootName(value = &quot;user&quot;) - 增加一个头key</li><li>@JsonUnwrapped - 干掉包装类</li><li>@JsonSerialize(as=BasicType.class) - 以别人的样子输出</li><li>@JsonView - 以不同视图过滤属性（可作用在RequestMapping）</li></ul><p>通常要避免全局类型的Filter和MixIn，推荐Session级的注解。</p><ul><li>同一pojo，不同场景的属性名不同，比如password和secret</li><li>同一pojo，不同场景的属性值不同，比如yyyy-MM-dd和MMM-dd,yyyy</li></ul><p>对于以上场景，仍然要遵循静态性和强类型原则，通常可以采用以下建议，</p><ul><li>自己的类，使用@JsonView + 不同的getter区分不同场景</li><li>第三方类，使用Override子类 + MapStruct复制属性</li><li>自定义JsonSerialize或Converter，不推荐</li><li>自定义 ResponseBodyAdvice，不推荐</li></ul><p>默认配置下，仅有@JsonView可作用于RequestMapping，其他注解要注到Pojo上。参考资料，</p>`,34),d={href:"https://www.baeldung.com/jackson-annotations",target:"_blank",rel:"noopener noreferrer"},u={href:"https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations",target:"_blank",rel:"noopener noreferrer"},m={href:"https://docs.spring.io/spring-boot/docs/3.0.3/reference/htmlsingle/#howto.spring-mvc.customize-jackson-objectmapper",target:"_blank",rel:"noopener noreferrer"},h=t(`<h2 id="_3a-8-反序列化泛型" tabindex="-1"><a class="header-anchor" href="#_3a-8-反序列化泛型" aria-hidden="true">#</a> 3A.8.反序列化泛型</h2><p>Jackson中涉及到泛型，参数类型，必备技能</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TypeReference</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// TypeFactory 中有很丰富的类型构造</span>
<span class="token class-name">JavaType</span> type <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getTypeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructCollectionType</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3);function v(g,k){const a=r("ExternalLinkIcon");return i(),l("div",null,[p,e("ul",null,[e("li",null,[e("a",d,[n("baeldung 示例"),s(a)])]),e("li",null,[e("a",u,[n("jackson注解"),s(a)])]),e("li",null,[e("a",m,[n("spring定制jackson"),s(a)])])]),h])}const f=o(c,[["render",v],["__file","3a-jackson.html.vue"]]);export{f as default};
