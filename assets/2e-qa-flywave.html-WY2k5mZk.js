import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,e as n}from"./app-BcJ4NaN5.js";const l={},e=n(`<h1 id="_2e-flywave-faq-topic" tabindex="-1"><a class="header-anchor" href="#_2e-flywave-faq-topic"><span>2E.Flywave Faq Topic</span></a></h1><p>Topic about flywave, schema/data versioning, journal data.</p><h2 id="_2e-01-customize-journalservice" tabindex="-1"><a class="header-anchor" href="#_2e-01-customize-journalservice"><span>2E.01.Customize journalService</span></a></h2><p>Inject high priority <code>journalService</code>, see <code>SecurityJournalService</code> of example project</p><h2 id="_2e-02-no-chemarevisionmanager" tabindex="-1"><a class="header-anchor" href="#_2e-02-no-chemarevisionmanager"><span>2E.02.No chemaRevisionManager</span></a></h2><p>After 2.2.6, <code>wings.enabled.faceless.flywave=false</code> is disabled by default. needs to enable during initialization, for example by adding a temporary turn on in test <code>@SpringBootTest(properties = &quot;wings.enabled.faceless.flywave=true&quot;)</code></p><h2 id="_2e-03-missing-branches-error" tabindex="-1"><a class="header-anchor" href="#_2e-03-missing-branches-error"><span>2E.03.Missing Branches Error</span></a></h2><p>After 2.2.7, sys_schema_version supports branch, in previous versions, it needed to be maintained manually. Just execute <code>2019_0512_02</code> in <code>branch/somefix/v227-fix</code>.</p><h2 id="_2e-04-testcase-or-examples-for-flywave" tabindex="-1"><a class="header-anchor" href="#_2e-04-testcase-or-examples-for-flywave"><span>2E.04.Testcase or Examples for Flywave</span></a></h2><ul><li><p>SchemaJournalManagerTest - shard and track test</p></li><li><p>SchemaRevisionMangerTest - basic versioning test</p></li><li><p>SchemaShardingManagerTest - shard and data migration test</p></li><li><p>WingsFlywaveInitDatabaseSample - database versioning example</p></li><li><p>ConstantEnumGenSample - enum code generation example</p></li><li><p>JooqJavaCodeGenSample - jooq code generation example</p></li><li><p>WingsSchemaDumper - schema and data dump example</p></li><li><p>WingsSchemaJournal - track table control example</p></li></ul><h2 id="_2e-05-confirm-dangerous-sql-in-flywave" tabindex="-1"><a class="header-anchor" href="#_2e-05-confirm-dangerous-sql-in-flywave"><span>2E.05.Confirm Dangerous Sql in Flywave</span></a></h2><ul><li>sql with <code>ask@*</code> annotation to force confirmation</li><li>undo statement confirms <code>wings.faceless.flywave.ver.ask-undo=true</code></li><li>drop statement validation <code>wings.faceless.flywave.ver.ask-drop=true</code></li><li>drop statement definition <code>wings.faceless.flywave.ver.drop-reg[drop-table]</code></li></ul><p>If console has no output in UnitTest, you need to open <code>console</code> in the IDE, e.g. in Idea <code>-Deditable.java.test.console=true</code> (Help/Edit Custom VM Options...)</p><h2 id="_2e-06-no-index-required-for-trace-tables" tabindex="-1"><a class="header-anchor" href="#_2e-06-no-index-required-for-trace-tables"><span>2E.06.No Index Required for Trace Tables</span></a></h2><p>If an existing index is updated to trace tables and it affects write performance, or a unique constraint, check it out with the following sql.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DISTINCT</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;DROP INDEX &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,INDEX_NAME,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; ON &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,TABLE_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">STATISTICS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TABLE_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> INDEX_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;PRIMARY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;RAW_TABLE_PK&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;%$%&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;%__%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Specify the table to be updated with the <code>apply@</code> statement. For example, the following updates plain tables and shard tables without trace tables</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- @plain apply@nut error@skip</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`win_user\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`ft_auth_set\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`ft_role_set\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-07-list-all-plain-shard-trace-tables" tabindex="-1"><a class="header-anchor" href="#_2e-07-list-all-plain-shard-trace-tables"><span>2E.07.List All Plain/Shard/Trace Tables</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- only trace</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(table_name),</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(substring_index(table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tbl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  group_concat(SUBSTRING_INDEX(table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  GROUP BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tbl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  table_name,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;DROP TABLE IF EXISTS &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\\\\$|__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- only shard</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(table_name),</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(substring_index(table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tbl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  group_concat(SUBSTRING_INDEX(table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> num</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_[0-9]+$&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  group by</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tbl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  table_name,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;DROP TABLE IF EXISTS &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_[0-9]+$&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- only plain</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> REGEXP </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_[0-9]+$&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\\\\$|__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-08-flywave-for-legacy-project" tabindex="-1"><a class="header-anchor" href="#_2e-08-flywave-for-legacy-project"><span>2E.08.Flywave for Legacy Project</span></a></h2><p>For legacy projects, to keep the original schema and data, you may not be able to use the naming of wings, divided into the following cases.</p><ul><li>Without <code>sys_schema_*</code> table, you can set your own table in wings-flywave-79.properties, and create the same structure table manually.</li><li>With the <code>sys_schema_*</code> table, you can replace 1ST_SCHEMA with a new name.</li><li>Without <code>rename</code> the table, you can use the initialization script in the <code>branch</code> and <code>forceExecuteSql</code> to execute it.</li></ul><p>Of the above methods, we recommend using the last one, after doing the manual initialization, then managing the database version through flywave.</p><p>Except for the initial version, which is executed during checkAndInit, other versions need to be published or executed</p><h2 id="_2e-09-list-or-delete-all-triggers" tabindex="-1"><a class="header-anchor" href="#_2e-09-list-or-delete-all-triggers"><span>2E.09.List or Delete All Triggers</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  EVENT_OBJECT_TABLE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TRIGGER_NAME,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ACTION_TIMING,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  EVENT_MANIPULATION,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ACTION_STATEMENT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TRIGGERS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  EVENT_OBJECT_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- get create sql of trigger;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- DELIMITER ;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TRIGGER_NAME,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;DROP TRIGGER IF EXISTS &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,TRIGGER_NAME,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;CREATE TRIGGER \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, TRIGGER_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ACTION_TIMING, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, EVENT_MANIPULATION, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; ON \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, EVENT_OBJECT_TABLE, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` FOR EACH ROW &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ACTION_STATEMENT, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TRIGGERS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  EVENT_OBJECT_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- as flywave naming rules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TRIGGER_NAME,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;DROP TRIGGER IF EXISTS &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,TRIGGER_NAME,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">TRIGGERS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  EVENT_OBJECT_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TRIGGER_NAME RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;^(bi|ai|bu|au|bd|ad)__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-10-record-count-of-trace-table" tabindex="-1"><a class="header-anchor" href="#_2e-10-record-count-of-trace-table"><span>2E.10.Record Count of Trace Table</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  table_schema,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;delete from &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,table_name,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; where _dt &lt; \\&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2020</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">07</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">01</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CEILING</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(data_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> data_mb,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CEILING</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(index_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> index_mb,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  CEILING</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((data_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> index_length) </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> all_mb,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  table_rows</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tables</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  table_name RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\\\\$|__&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema , all_mb </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-11-manually-repair-trace-template" tabindex="-1"><a class="header-anchor" href="#_2e-11-manually-repair-trace-template"><span>2E.11.Manually Repair Trace Template</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}__\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  MODIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> COLUMN </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">\`_id\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FIRST</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> COLUMN </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">\`_dt\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DATETIME</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;1000-01-01 00:00:00&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> AFTER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`_id\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> COLUMN </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">\`_tp\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;Z&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> AFTER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`_dt\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">DELIMITER ;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ai__{{TABLE_NAME}}</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\` </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AFTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INSERT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> EACH </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ROW</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> BEGIN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@DISABLE_FLYWAVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">THEN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}__\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;C&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, t.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> t</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  END</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">au__{{TABLE_NAME}}</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\` </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AFTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> UPDATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> EACH </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ROW</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> BEGIN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@DISABLE_FLYWAVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">THEN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}__\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;U&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, t.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> t</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  END</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bd__{{TABLE_NAME}}</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\` </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BEFORE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> EACH </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ROW</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> BEGIN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@DISABLE_FLYWAVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">THEN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}__\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;D&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, t.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`{{TABLE_NAME}}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> t</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  END</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">DELIMITER ;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-12-partial-recovery-data-by-trace-table" tabindex="-1"><a class="header-anchor" href="#_2e-12-partial-recovery-data-by-trace-table"><span>2E.12.Partial Recovery Data by Trace Table</span></a></h2><p>Using dynamic SQL, get the latest data from the log table and REPLACE INTO the main table. During this time, you must disable the Trigger with <code>@DISABLE_FLYWAVE = 1</code>.</p><p>To avoid business interruption, write the max_id of log to a temporary table, or a static sql.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- SET @group_concat_max_len = @@global.max_allowed_packet;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;win_user_basis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @cols</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,GROUP_CONCAT(COLUMN_NAME SEPARATOR </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`, \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">COLUMNS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ORDINAL_POSITION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- &#39;REPLACE INTO &#39;, @tabl,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; SELECT &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@cols</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; FROM &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__ WHERE (_id,id) IN (&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; SELECT max(_id), id FROM &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__ &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; WHERE _tp in (\\&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">D\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;)&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; GROUP BY id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;)&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">--</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @DISABLE_FLYWAVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">PREPARE stmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">EXECUTE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> stmt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @DISABLE_FLYWAVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-13-manually-create-trace-tables-and-triggers" tabindex="-1"><a class="header-anchor" href="#_2e-13-manually-create-trace-tables-and-triggers"><span>2E.13.Manually Create Trace Tables and Triggers</span></a></h2><p>With flywave you can have better hints, logging. But it can also be done by manual sql.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- generate trace table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;owt_lading_main&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @cols</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  GROUP_CONCAT(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,COLUMN_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, COLUMN_TYPE,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; COMMENT \\&#39;&#39;, replace(COLUMN_COMMENT,&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\\\\\\&#39;&#39;),&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">COLUMNS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TABLE_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ORDINAL_POSITION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @prik</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  GROUP_CONCAT(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,COLUMN_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">COLUMNS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  TABLE_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    AND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> COLUMN_KEY </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;PRI&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ORDINAL_POSITION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tracerSql</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;CREATE TABLE &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__ (&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; \`_id\` BIGINT(20) NOT NULL AUTO_INCREMENT, &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; \`_dt\` DATETIME(3) NOT NULL DEFAULT \\&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">01</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">01</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; \`_tp\` CHAR(1) NOT NULL DEFAULT \\&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Z\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@cols</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; PRIMARY KEY (\`_id\`), &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39; KEY \`RAW_TABLE_PK\` (&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@prik</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;)&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tracerSql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">PREPARE stmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tracerSql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">EXECUTE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> stmt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- generate trigger sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @tabl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;win_user_basis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @triggerSql</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;DELIMITER ;;\\n&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;CREATE TRIGGER \`ai__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` AFTER INSERT ON \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` FOR EACH ROW BEGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; IF (@DISABLE_FLYWAVE IS NULL) THEN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; INSERT INTO \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__\` SELECT NULL, NOW(3), \\&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">C\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, t.* FROM \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` t WHERE t.id = NEW.id ;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; END IF;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;END;;\\n&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;CREATE TRIGGER \`au__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` AFTER UPDATE ON \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` FOR EACH ROW BEGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; IF (@DISABLE_FLYWAVE IS NULL) THEN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; INSERT INTO \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__\` SELECT NULL, NOW(3), \\&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">U\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, t.* FROM \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` t WHERE t.id = NEW.id ;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; END IF;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;END;;\\n&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;CREATE TRIGGER \`bd__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` BEFORE DELETE ON \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` FOR EACH ROW BEGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; IF (@DISABLE_FLYWAVE IS NULL) THEN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; INSERT INTO \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__\` SELECT NULL, NOW(3), \\&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">D\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;, t.* FROM \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;\` t WHERE t.id = OLD.id ;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39; END IF;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &#39;END;;\\n&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">   );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> @triggerSql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2e-14-what-if-not-support-naming" tabindex="-1"><a class="header-anchor" href="#_2e-14-what-if-not-support-naming"><span>2E.14.What if Not Support <code>$</code> Naming</span></a></h2><p>After version 210, wings are named with a double underscore <code>__</code>, which replaces the dollar<code>$</code> naming convention.</p><p>The alphanum, dollar and underscore (<code>[0-9,a-z,A-Z$_]</code>) are all officially legal <a href="https://dev.mysql.com/doc/refman/5.7/en/identifiers.html" target="_blank" rel="noopener noreferrer">naming characters</a>.</p><p>However, some incompatible cloud DB or tools are not well handled, but wings must avoid the 3rd functional defects.</p><p>If the DB or tool cannot be replaced, the default convention and implementation of wings can be modified. This option is a hidden feature, passes basic testing, and is generally not recommended.</p><ul><li>Change the suffix separator, e.g. <code>__</code>, two underscores.</li><li>Use prefixes, like <code>_</code>, starting with an underscore.</li></ul><p>Each option that affects flywave&#39;s matching tables and scripts, must be changed on a case-by-case basis. When using prefixes, it also affects the sorting of the table name, and it is not easy to visually see if the plain table has a trace table.</p><p>The simple way is to change the <code>wings.faceless.flywave.ver.format-</code> configuration.</p><p>The principle is to modify the SqlSegmentProcessor.setXXXFormat method to set the expression. The expression must be precise to avoid mismatching the relationship between plain, shard and trace tables.</p><p>With <code>XXX</code> for the plain table and <code>#</code> for the letter, SqlSegmentProcessor provides 3 types of expressions by default</p><ul><li>TRACE_DOLLAR - separated by a dollar<code>$</code> suffix, such as <code>XXX$#</code></li><li>TRACE_SU2_LINE - separated by a double underscore <code>__</code> suffix, e.g. <code>XXX__#</code></li><li>TRACE_PRE_LINE - separated by a single underscore <code>_</code> prefix, e.g. <code>_XXX</code> or <code>_#_XXX</code></li></ul>`,49),h=[e];function t(k,p){return a(),i("div",null,h)}const B=s(l,[["render",t],["__file","2e-qa-flywave.html.vue"]]),g=JSON.parse('{"path":"/2-faceless/2e-qa-flywave.html","title":"2E.Flywave Faq Topic","lang":"en-US","frontmatter":{"isOriginal":true,"icon":"code-compare","category":["Faceless","Version","Topic"],"description":"2E.Flywave Faq Topic Topic about flywave, schema/data versioning, journal data. 2E.01.Customize journalService Inject high priority journalService, see SecurityJournalService of...","GIT_REPO_HEAD":"2024-07-07 fbb1f4817448a18f6c9bd497c9b5837508d2198e","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://wings.fessional.pro/zh/2-faceless/2e-qa-flywave.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/2-faceless/2e-qa-flywave.html"}],["meta",{"property":"og:site_name","content":"WingsBoot Win Sprint"}],["meta",{"property":"og:title","content":"2E.Flywave Faq Topic"}],["meta",{"property":"og:description","content":"2E.Flywave Faq Topic Topic about flywave, schema/data versioning, journal data. 2E.01.Customize journalService Inject high priority journalService, see SecurityJournalService of..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-12T00:21:52.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2024-06-12T00:21:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"2E.Flywave Faq Topic\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-12T00:21:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"2E.01.Customize journalService","slug":"_2e-01-customize-journalservice","link":"#_2e-01-customize-journalservice","children":[]},{"level":2,"title":"2E.02.No chemaRevisionManager","slug":"_2e-02-no-chemarevisionmanager","link":"#_2e-02-no-chemarevisionmanager","children":[]},{"level":2,"title":"2E.03.Missing Branches Error","slug":"_2e-03-missing-branches-error","link":"#_2e-03-missing-branches-error","children":[]},{"level":2,"title":"2E.04.Testcase or Examples for Flywave","slug":"_2e-04-testcase-or-examples-for-flywave","link":"#_2e-04-testcase-or-examples-for-flywave","children":[]},{"level":2,"title":"2E.05.Confirm Dangerous Sql in Flywave","slug":"_2e-05-confirm-dangerous-sql-in-flywave","link":"#_2e-05-confirm-dangerous-sql-in-flywave","children":[]},{"level":2,"title":"2E.06.No Index Required for Trace Tables","slug":"_2e-06-no-index-required-for-trace-tables","link":"#_2e-06-no-index-required-for-trace-tables","children":[]},{"level":2,"title":"2E.07.List All Plain/Shard/Trace Tables","slug":"_2e-07-list-all-plain-shard-trace-tables","link":"#_2e-07-list-all-plain-shard-trace-tables","children":[]},{"level":2,"title":"2E.08.Flywave for Legacy Project","slug":"_2e-08-flywave-for-legacy-project","link":"#_2e-08-flywave-for-legacy-project","children":[]},{"level":2,"title":"2E.09.List or Delete All Triggers","slug":"_2e-09-list-or-delete-all-triggers","link":"#_2e-09-list-or-delete-all-triggers","children":[]},{"level":2,"title":"2E.10.Record Count of Trace Table","slug":"_2e-10-record-count-of-trace-table","link":"#_2e-10-record-count-of-trace-table","children":[]},{"level":2,"title":"2E.11.Manually Repair Trace Template","slug":"_2e-11-manually-repair-trace-template","link":"#_2e-11-manually-repair-trace-template","children":[]},{"level":2,"title":"2E.12.Partial Recovery Data by Trace Table","slug":"_2e-12-partial-recovery-data-by-trace-table","link":"#_2e-12-partial-recovery-data-by-trace-table","children":[]},{"level":2,"title":"2E.13.Manually Create Trace Tables and Triggers","slug":"_2e-13-manually-create-trace-tables-and-triggers","link":"#_2e-13-manually-create-trace-tables-and-triggers","children":[]},{"level":2,"title":"2E.14.What if Not Support $ Naming","slug":"_2e-14-what-if-not-support-naming","link":"#_2e-14-what-if-not-support-naming","children":[]}],"git":{"createdTime":1655901635000,"updatedTime":1718151712000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":5}]},"readingTime":{"minutes":4.76,"words":1427},"filePathRelative":"2-faceless/2e-qa-flywave.md","localizedDate":"June 22, 2022","autoDesc":true}');export{B as comp,g as data};
