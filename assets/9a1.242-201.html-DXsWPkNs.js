import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as n,c as l,b as s,d as i,f as t,w as h,e as k,o as p}from"./app-DEdToB0k.js";const r={},d=s("h1",{id:"_9a1-升迁2-4-2-201手册",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_9a1-升迁2-4-2-201手册"},[s("span",null,"9A1.升迁2.4.2.201手册")])],-1),g=s("p",null,"build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。",-1),A=s("li",null,"调整pom.xml结构，原wings-home变为wings-project",-1),o=s("li",null,"flywave journal管理采用新的trigger形式",-1),c=s("li",null,"flywave 默认全部确认，无交互情况，需要手动设置askYes",-1),B=k(`<h2 id="_9a1-1-设置maven" tabindex="-1"><a class="header-anchor" href="#_9a1-1-设置maven"><span>9A1.1.设置maven</span></a></h2><p>parent依赖变化，从<code>wings-home:2.4.2.200-SNAPSHOT</code>到<code>wings-project:2.4.2.201-SNAPSHOT</code></p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pro.fessional&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;wings-project&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;2.4.2.201-SNAPSHOT&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-2-表结构调整" tabindex="-1"><a class="header-anchor" href="#_9a1-2-表结构调整"><span>9A1.2.表结构调整</span></a></h2><p>按下列顺序，依次执行操作</p><ul><li>执行 2021-12-20v01-journal-trg-insert.sql 新增journal结构</li><li>执行 JournalManager.manageTriggers(table, true) 删除旧trigger</li><li>执行 JournalManager.checkAndInitDdl(table, cid) 以新配置替换旧配置</li><li>执行 JournalManager.publishInsert/Update/Delete(table,true, cid) 生成新trigger</li></ul><p>如果需要把原跟踪表的数据导入新跟踪表，且希望旧数据与新数据的时序保持同_id递增， 则需要手动设置AUTO_INCREMENT，使其大于旧表数据数总数。并且手动更新操作期间插入的数据_id</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $count;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">log</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> _id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $count + _id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>不介意顺序，或已调整好AUTO_INCREMENT启动时，执行以下sql导入数据</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @tabl</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;win_user_basis&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @cols</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, GROUP_CONCAT(COLUMN_NAME SEPARATOR </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\`, \`&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\`&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">COLUMNS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TABLE_SCHEMA </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TABLE_NAME </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @tabl</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ORDINAL_POSITION</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> CONCAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &#39;INSERT INTO &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">@tabl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$log&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &#39; SELECT NULL, _dt, _tp, &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">@cols</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; FROM ((SELECT *,\\&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">U\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; as _tp FROM &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        @tabl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$upd) UNION (SELECT *,\\&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">D\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; as _tp FROM &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        @tabl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$del)) as old ORDER BY _dt&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">PREPARE stmt </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @restoreSql</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">EXECUTE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> stmt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-3-编译错误" tabindex="-1"><a class="header-anchor" href="#_9a1-3-编译错误"><span>9A1.3.编译错误</span></a></h2><p>根据编译提示，设置InteractiveManager的方法。 如果曾经在自动环境下（batch，web）执行flywave管理数据表， 需要自己定义InteractiveManager.askWay实现。默认实现有</p><ul><li>FlywaveInteractiveTty 以控制台为主</li><li>FlywaveInteractiveGui 以swing对话框为主</li></ul><p>如启动时报告 HeadlessException，可能是在wings之前使用了AWT的Font，Color等</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">at </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">java</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">awt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">GraphicsEnvironment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">checkHeadless</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">GraphicsEnvironment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">java</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">204</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>需要在最接近或先于main的代码中设置 <code>System.setProperty(&quot;java.awt.headless&quot;, &quot;false&quot;);</code> 或者在jvm启动参数上设置 <code>-Djava.awt.headless=false</code></p><h2 id="_9a1-4-数据源调整" tabindex="-1"><a class="header-anchor" href="#_9a1-4-数据源调整"><span>9A1.4.数据源调整</span></a></h2><p>为分表分库场景分离出faceless-shard工程。从而DataSource默认使用spring形式。</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 替换为spring默认数据源</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">spring.datasource.url</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">spring.datasource.username</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">spring.datasource.password</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19);function y(m,u){const a=n("RouteLink");return p(),l("div",null,[d,g,s("ul",null,[A,o,c,s("li",null,[i("检查"),t(a,{to:"/zh/9-example/9a.wings-change/9a0.notable.html"},{default:h(()=>[i("wings notable changelog")]),_:1})])]),B])}const C=e(r,[["render",y],["__file","9a1.242-201.html.vue"]]),F=JSON.parse('{"path":"/zh/9-example/9a.wings-change/9a1.242-201.html","title":"9A1.升迁2.4.2.201手册","lang":"zh-CN","frontmatter":{"isOriginal":true,"icon":"circle-up","category":["实战","升迁"],"description":"9A1.升迁2.4.2.201手册 build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。 调整pom.xml结构，原wings-home变为wings-project flywave journal管理采用新的trigger形式 flywave 默认全部确认，无交互情况，需要手动设置askYes 检查 9A1.1.设置ma...","GIT_REPO_HEAD":"2025-01-17 e638e7035dc7958e3f145793e37c871eb02f12d5","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://wings.fessional.pro/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/zh/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:site_name","content":"WingsBoot 纹丝不忒"}],["meta",{"property":"og:title","content":"9A1.升迁2.4.2.201手册"}],["meta",{"property":"og:description","content":"9A1.升迁2.4.2.201手册 build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。 调整pom.xml结构，原wings-home变为wings-project flywave journal管理采用新的trigger形式 flywave 默认全部确认，无交互情况，需要手动设置askYes 检查 9A1.1.设置ma..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-12T00:21:52.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2024-06-12T00:21:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"9A1.升迁2.4.2.201手册\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-12T00:21:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"9A1.1.设置maven","slug":"_9a1-1-设置maven","link":"#_9a1-1-设置maven","children":[]},{"level":2,"title":"9A1.2.表结构调整","slug":"_9a1-2-表结构调整","link":"#_9a1-2-表结构调整","children":[]},{"level":2,"title":"9A1.3.编译错误","slug":"_9a1-3-编译错误","link":"#_9a1-3-编译错误","children":[]},{"level":2,"title":"9A1.4.数据源调整","slug":"_9a1-4-数据源调整","link":"#_9a1-4-数据源调整","children":[]}],"git":{"createdTime":1656137116000,"updatedTime":1718151712000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":2}]},"readingTime":{"minutes":1.75,"words":524},"filePathRelative":"zh/9-example/9a.wings-change/9a1.242-201.md","localizedDate":"2022年6月25日","autoDesc":true}');export{C as comp,F as data};
