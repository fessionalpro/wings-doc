import{_ as s}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as a,c as n,e}from"./app.9b602252.js";const t={},p=e(`<h1 id="_9a1-\u8FC1\u79FB2-4-2-201\u624B\u518C" tabindex="-1"><a class="header-anchor" href="#_9a1-\u8FC1\u79FB2-4-2-201\u624B\u518C" aria-hidden="true">#</a> 9A1.\u8FC1\u79FB2.4.2.201\u624B\u518C</h1><p>build\u7248\u4ECE200\u5347\u7EA7201\uFF0C\u66F4\u9760\u8FD1flywave\u7684\u5DE5\u7A0B\u5B9E\u8DF5\uFF0C\u6709\u91CD\u5927\u4E0D\u517C\u5BB9\u5F71\u54CD\u3002</p><ul><li>\u8C03\u6574pom.xml\u7ED3\u6784\uFF0C\u539Fwings-home\u53D8\u4E3Awings-project</li><li>flywave journal\u7BA1\u7406\u91C7\u7528\u65B0\u7684trigger\u5F62\u5F0F</li><li>flywave \u9ED8\u8BA4\u5168\u90E8\u786E\u8BA4\uFF0C\u65E0\u4EA4\u6362\u60C5\u51B5\uFF0C\u9700\u8981\u624B\u52A8\u8BBE\u7F6EaskYes</li></ul><h2 id="_9a1-1-\u8BBE\u7F6Emaven" tabindex="-1"><a class="header-anchor" href="#_9a1-1-\u8BBE\u7F6Emaven" aria-hidden="true">#</a> 9A1.1.\u8BBE\u7F6Emaven</h2><p>parent\u4F9D\u8D56\u53D8\u5316\uFF0C\u4ECE<code>wings-home:2.4.2.200-SNAPSHOT</code>\u5230<code>wings-project:2.4.2.201-SNAPSHOT</code></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>wings-project<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2.201-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-2-\u8868\u7ED3\u6784\u8C03\u6574" tabindex="-1"><a class="header-anchor" href="#_9a1-2-\u8868\u7ED3\u6784\u8C03\u6574" aria-hidden="true">#</a> 9A1.2.\u8868\u7ED3\u6784\u8C03\u6574</h2><p>\u6309\u4E0B\u5217\u987A\u5E8F\uFF0C\u4F9D\u6B21\u6267\u884C\u64CD\u4F5C</p><ul><li>\u6267\u884C 2021-12-20v01-journal-trg-insert.sql \u65B0\u589Ejournal\u7ED3\u6784</li><li>\u6267\u884C JournalManager.manageTriggers(table, true) \u5220\u9664\u65E7trigger</li><li>\u6267\u884C JournalManager.checkAndInitDdl(table, cid) \u4EE5\u65B0\u914D\u7F6E\u66FF\u6362\u65E7\u914D\u7F6E</li><li>\u6267\u884C JournalManager.publishInsert/Update/Delete(table,true, cid) \u751F\u6210\u65B0trigger</li></ul><p>\u5982\u679C\u9700\u8981\u628A\u539F\u8DDF\u8E2A\u8868\u7684\u6570\u636E\u5BFC\u5165\u65B0\u8DDF\u8E2A\u8868\uFF0C\u4E14\u5E0C\u671B\u65E7\u6570\u636E\u4E0E\u65B0\u6570\u636E\u7684\u65F6\u5E8F\u4FDD\u6301\u540C_id\u9012\u589E\uFF0C \u5219\u9700\u8981\u624B\u52A8\u8BBE\u7F6EAUTO_INCREMENT\uFF0C\u4F7F\u5176\u5927\u4E8E\u65E7\u8868\u6570\u636E\u6570\u603B\u6570\u3002\u5E76\u4E14\u624B\u52A8\u66F4\u65B0\u64CD\u4F5C\u671F\u95F4\u63D2\u5165\u7684\u6570\u636E_id</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token keyword">table</span>$log <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> $count<span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> <span class="token keyword">table</span>$log <span class="token keyword">set</span> _id <span class="token operator">=</span> $count <span class="token operator">+</span> _id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u4ECB\u610F\u987A\u5E8F\uFF0C\u6216\u5DF2\u8C03\u6574\u597DAUTO_INCREMENT\u542F\u52A8\u65F6\uFF0C\u6267\u884C\u4EE5\u4E0Bsql\u5BFC\u5165\u6570\u636E</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token variable">@tabl</span> <span class="token operator">=</span> <span class="token string">&#39;win_user_basis&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@cols</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">&#39;\`&#39;</span><span class="token punctuation">,</span> GROUP_CONCAT<span class="token punctuation">(</span>COLUMN_NAME SEPARATOR <span class="token string">&#39;\`, \`&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;\`&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
    <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">AND</span> TABLE_NAME <span class="token operator">=</span> <span class="token variable">@tabl</span>
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ORDINAL_POSITION
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@restoreSql</span> <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span>
        <span class="token string">&#39;INSERT INTO &#39;</span><span class="token punctuation">,</span> <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$log&#39;</span>
            <span class="token string">&#39; SELECT NULL, _dt, _tp, &#39;</span><span class="token punctuation">,</span> <span class="token variable">@cols</span><span class="token punctuation">,</span><span class="token string">&#39; FROM ((SELECT *,\\&#39;U\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$upd) UNION (SELECT *,\\&#39;D\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$del)) as old ORDER BY _dt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>

<span class="token keyword">PREPARE</span> stmt <span class="token keyword">FROM</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> stmt<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-3-\u7F16\u8BD1\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#_9a1-3-\u7F16\u8BD1\u9519\u8BEF" aria-hidden="true">#</a> 9A1.3.\u7F16\u8BD1\u9519\u8BEF</h2><p>\u6839\u636E\u7F16\u8BD1\u63D0\u793A\uFF0C\u8BBE\u7F6EInteractiveManager\u7684\u65B9\u6CD5\u3002 \u5982\u679C\u66FE\u7ECF\u5728\u81EA\u52A8\u73AF\u5883\u4E0B\uFF08batch\uFF0Cweb\uFF09\u6267\u884Cflywave\u7BA1\u7406\u6570\u636E\u8868\uFF0C \u9700\u8981\u81EA\u52A8\u5B9A\u4E49InteractiveManager.askWay\u5B9E\u73B0\u3002\u9ED8\u8BA4\u5B9E\u73B0\u6709</p><ul><li>FlywaveInteractiveTty \u4EE5\u63A7\u5236\u53F0\u4E3A\u4E3B</li><li>FlywaveInteractiveGui \u4EE5swing\u5BF9\u8BDD\u6846\u4E3A\u4E3B</li></ul><p>\u5982\u542F\u52A8\u65F6\u62A5\u544A HeadlessException\uFF0C\u53EF\u80FD\u662F\u5728wings\u4E4B\u524D\u4F7F\u7528\u4E86AWT\u7684Font\uFF0CColor\u7B49</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span>GraphicsEnvironment</span><span class="token punctuation">.</span><span class="token function">checkHeadless</span><span class="token punctuation">(</span><span class="token class-name">GraphicsEnvironment</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u9700\u8981\u5728\u6700\u63A5\u8FD1\u6216\u5148\u4E8Emain\u7684\u4EE3\u7801\u4E2D\u8BBE\u7F6E <code>System.setProperty(&quot;java.awt.headless&quot;, &quot;false&quot;);</code> \u6216\u8005\u5728jvm\u542F\u52A8\u53C2\u6570\u4E0A\u8BBE\u7F6E <code>-Djava.awt.headless=false</code></p><h2 id="_9a1-4-\u6570\u636E\u6E90\u8C03\u6574" tabindex="-1"><a class="header-anchor" href="#_9a1-4-\u6570\u636E\u6E90\u8C03\u6574" aria-hidden="true">#</a> 9A1.4.\u6570\u636E\u6E90\u8C03\u6574</h2><p>\u4E3A\u5206\u8868\u5206\u5E93\u573A\u666F\u5206\u79BB\u51FAfaceless-shard\u5DE5\u7A0B\u3002\u4ECE\u800CDataSource\u9ED8\u8BA4\u4F7F\u7528spring\u5F62\u5F0F\u3002</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u79FB\u9664\u539Fspring.shardingsphere.datasource\u914D\u7F6E</span>
<span class="token comment">#spring.shardingsphere.datasource.writer.jdbc-url</span>
<span class="token comment">#spring.shardingsphere.datasource.writer.username</span>
<span class="token comment">#spring.shardingsphere.datasource.writer.password</span>
<span class="token comment"># \u66FF\u6362\u4E3Aspring\u9ED8\u8BA4\u6570\u636E\u6E90</span>
spring.datasource.url
spring.datasource.username
spring.datasource.password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22),l=[p];function o(i,c){return a(),n("div",null,l)}const u=s(t,[["render",o],["__file","9a1.242-201.html.vue"]]);export{u as default};
