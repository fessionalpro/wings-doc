import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as p,c as l,b as a,e as n,d as o,w as i,f as c}from"./app-D49wbIsR.js";const r={},d=a("h1",{id:"_9a1-升迁2-4-2-201手册",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_9a1-升迁2-4-2-201手册"},[a("span",null,"9A1.升迁2.4.2.201手册")])],-1),u=a("p",null,"build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。",-1),k=a("li",null,"调整pom.xml结构，原wings-home变为wings-project",-1),g=a("li",null,"flywave journal管理采用新的trigger形式",-1),v=a("li",null,"flywave 默认全部确认，无交互情况，需要手动设置askYes",-1),m=c(`<h2 id="_9a1-1-设置maven" tabindex="-1"><a class="header-anchor" href="#_9a1-1-设置maven"><span>9A1.1.设置maven</span></a></h2><p>parent依赖变化，从<code>wings-home:2.4.2.200-SNAPSHOT</code>到<code>wings-project:2.4.2.201-SNAPSHOT</code></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>wings-project<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2.201-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-2-表结构调整" tabindex="-1"><a class="header-anchor" href="#_9a1-2-表结构调整"><span>9A1.2.表结构调整</span></a></h2><p>按下列顺序，依次执行操作</p><ul><li>执行 2021-12-20v01-journal-trg-insert.sql 新增journal结构</li><li>执行 JournalManager.manageTriggers(table, true) 删除旧trigger</li><li>执行 JournalManager.checkAndInitDdl(table, cid) 以新配置替换旧配置</li><li>执行 JournalManager.publishInsert/Update/Delete(table,true, cid) 生成新trigger</li></ul><p>如果需要把原跟踪表的数据导入新跟踪表，且希望旧数据与新数据的时序保持同_id递增， 则需要手动设置AUTO_INCREMENT，使其大于旧表数据数总数。并且手动更新操作期间插入的数据_id</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token keyword">table</span>$log <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> $count<span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> <span class="token keyword">table</span>$log <span class="token keyword">set</span> _id <span class="token operator">=</span> $count <span class="token operator">+</span> _id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>不介意顺序，或已调整好AUTO_INCREMENT启动时，执行以下sql导入数据</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token variable">@tabl</span> <span class="token operator">=</span> <span class="token string">&#39;win_user_basis&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@cols</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">&#39;\`&#39;</span><span class="token punctuation">,</span> GROUP_CONCAT<span class="token punctuation">(</span>COLUMN_NAME SEPARATOR <span class="token string">&#39;\`, \`&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;\`&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
    <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">AND</span> TABLE_NAME <span class="token operator">=</span> <span class="token variable">@tabl</span>
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ORDINAL_POSITION
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@restoreSql</span> <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span>
        <span class="token string">&#39;INSERT INTO &#39;</span><span class="token punctuation">,</span> <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$log&#39;</span>
            <span class="token string">&#39; SELECT NULL, _dt, _tp, &#39;</span><span class="token punctuation">,</span> <span class="token variable">@cols</span><span class="token punctuation">,</span><span class="token string">&#39; FROM ((SELECT *,\\&#39;U\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$upd) UNION (SELECT *,\\&#39;D\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$del)) as old ORDER BY _dt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>

<span class="token keyword">PREPARE</span> stmt <span class="token keyword">FROM</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> stmt<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-3-编译错误" tabindex="-1"><a class="header-anchor" href="#_9a1-3-编译错误"><span>9A1.3.编译错误</span></a></h2><p>根据编译提示，设置InteractiveManager的方法。 如果曾经在自动环境下（batch，web）执行flywave管理数据表， 需要自己定义InteractiveManager.askWay实现。默认实现有</p><ul><li>FlywaveInteractiveTty 以控制台为主</li><li>FlywaveInteractiveGui 以swing对话框为主</li></ul><p>如启动时报告 HeadlessException，可能是在wings之前使用了AWT的Font，Color等</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span>GraphicsEnvironment</span><span class="token punctuation">.</span><span class="token function">checkHeadless</span><span class="token punctuation">(</span><span class="token class-name">GraphicsEnvironment</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>需要在最接近或先于main的代码中设置 <code>System.setProperty(&quot;java.awt.headless&quot;, &quot;false&quot;);</code> 或者在jvm启动参数上设置 <code>-Djava.awt.headless=false</code></p><h2 id="_9a1-4-数据源调整" tabindex="-1"><a class="header-anchor" href="#_9a1-4-数据源调整"><span>9A1.4.数据源调整</span></a></h2><p>为分表分库场景分离出faceless-shard工程。从而DataSource默认使用spring形式。</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment"># 替换为spring默认数据源</span>
spring.datasource.url
spring.datasource.username
spring.datasource.password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19);function h(b,_){const s=t("RouteLink");return p(),l("div",null,[d,u,a("ul",null,[k,g,v,a("li",null,[n("检查"),o(s,{to:"/zh/9-example/9a.wings-change/9a0.notable.html"},{default:i(()=>[n("wings notable changelog")]),_:1})])]),m])}const E=e(r,[["render",h],["__file","9a1.242-201.html.vue"]]),f=JSON.parse('{"path":"/zh/9-example/9a.wings-change/9a1.242-201.html","title":"9A1.升迁2.4.2.201手册","lang":"zh-CN","frontmatter":{"isOriginal":true,"icon":"change","category":["实战","升迁"],"description":"9A1.升迁2.4.2.201手册 build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。 调整pom.xml结构，原wings-home变为wings-project flywave journal管理采用新的trigger形式 flywave 默认全部确认，无交互情况，需要手动设置askYes 检查 9A1.1.设置ma...","GIT_REPO_HEAD":"2024-05-14 c11179d9405d56bdce1d844167180312da5251a8","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://wings.fessional.pro/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/zh/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:site_name","content":"WingsBoot 纹丝不忒"}],["meta",{"property":"og:title","content":"9A1.升迁2.4.2.201手册"}],["meta",{"property":"og:description","content":"9A1.升迁2.4.2.201手册 build版从200升级201，更靠近flywave的工程实践，有重大不兼容影响。 调整pom.xml结构，原wings-home变为wings-project flywave journal管理采用新的trigger形式 flywave 默认全部确认，无交互情况，需要手动设置askYes 检查 9A1.1.设置ma..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-06-18T08:37:26.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2023-06-18T08:37:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"9A1.升迁2.4.2.201手册\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-06-18T08:37:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"9A1.1.设置maven","slug":"_9a1-1-设置maven","link":"#_9a1-1-设置maven","children":[]},{"level":2,"title":"9A1.2.表结构调整","slug":"_9a1-2-表结构调整","link":"#_9a1-2-表结构调整","children":[]},{"level":2,"title":"9A1.3.编译错误","slug":"_9a1-3-编译错误","link":"#_9a1-3-编译错误","children":[]},{"level":2,"title":"9A1.4.数据源调整","slug":"_9a1-4-数据源调整","link":"#_9a1-4-数据源调整","children":[]}],"git":{"createdTime":1687077446000,"updatedTime":1687077446000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":1}]},"readingTime":{"minutes":1.74,"words":523},"filePathRelative":"zh/9-example/9a.wings-change/9a1.242-201.md","localizedDate":"2023年6月18日","autoDesc":true}');export{E as comp,f as data};
