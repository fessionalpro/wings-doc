import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{r as i,o as c,c as l,a as e,b as s,d as o,e as a}from"./app.96143157.js";const p={},r=o(`<h1 id="_2h-\u65F6\u95F4\u548C\u65F6\u533A" tabindex="-1"><a class="header-anchor" href="#_2h-\u65F6\u95F4\u548C\u65F6\u533A" aria-hidden="true">#</a> 2H.\u65F6\u95F4\u548C\u65F6\u533A</h1><p>\u6570\u636E\u5E93\u6709\u5173\u7684\u65F6\u95F4\uFF0C\u65F6\u533A\uFF0C\u96F6\u503C\u7EA6\u5B9A</p><h2 id="_2h-1-\u65E5\u65F6\u96F6\u503C\u548C\u65F6\u533A" tabindex="-1"><a class="header-anchor" href="#_2h-1-\u65E5\u65F6\u96F6\u503C\u548C\u65F6\u533A" aria-hidden="true">#</a> 2H.1.\u65E5\u65F6\u96F6\u503C\u548C\u65F6\u533A</h2><p>\u6267\u884C\u73AF\u5883\u548C\u6570\u636E\u5E93\u8981\u5728\u540C\u4E00\u65F6\u533A\uFF0C\u5426\u5219jooq\u548Cjdbc\u5728\u4EE5\u4E0B\u8FC7\u7A0B\u4F1A\u81EA\u52A8\u8F6C\u6362\u65F6\u533A\uFF0C\u5F15\u53D1\u95EE\u9898\u3002</p><p>\u5982\u679C\u670D\u52A1\u5668\u548C\u6267\u884C\u73AF\u5883\u65F6\u533A\u4E0D\u4E00\u81F4\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u65B9\u5F0F\u534F\u8C03\u3002</p><ul><li>\u901A\u8FC7wings\u7684\u53C2\u6570\u8BBE\u7F6E\u65F6\u533A <code>wings.silencer.i18n.zoneid=Asia/Shanghai</code></li><li>java\u7684\u542F\u52A8\u53C2\u6570\uFF0C <code>-Duser.timezone=Asia/Shanghai</code></li><li>mysql\u7684jdbc\u7684url\u53C2\u6570\uFF0C <code>connectionTimeZone=%2B08:00&amp;forceConnectionTimeZoneToSession=true</code></li><li>java\u7684\u4EE3\u7801\u53C2\u6570\uFF0C <code>TimeZone.setDefault(TimeZone.getTimeZone(&quot;Asia/Shanghai&quot;));</code></li></ul><p>\u5728\u6570\u636E\u5E93\u548Cjava\u914D\u7F6E\u4E0A\uFF0C\u9700\u8981\u7EDF\u4E00\u65F6\u533A\u548Cdev\u72B6\u6001\u4E0B\u7684\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u4E00\u822C\u56E2\u961F\u4E00\u81F4\u3002</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">wings.silencer.i18n.zoneid</span><span class="token punctuation">=</span><span class="token value attr-value">Asia/Shanghai</span>
<span class="token comment"># \u5E38\u7528jdbc\u53C2\u6570</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/wings_example\\
  ?autoReconnect=true&amp;useSSL=false\\
  &amp;useUnicode=true&amp;characterEncoding=UTF-8\\
  &amp;connectionTimeZone=Asia/Shanghai</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F15\u53D1\u95EE\u9898\u7684\u539F\u56E0\uFF0C\u76EE\u524D\u65AD\u5B9A\u4E3Ajdbc\u548Ctimestamp\u5386\u53F2\u95EE\u9898\uFF08wings210\u540E\u7EDF\u4E00mysql8\uFF0C\u5DF2\u7EDF\u4E00\u89E3\u51B3\uFF09</p><ul><li>jooq\uFF0C\u4F7F\u7528timestamp\u4F5C\u4E3AlocalDatetime\u7684\u503C\uFF0C\u8BBE\u7F6EpreparedStatement\u3002</li><li>jdbc\uFF0CsetTimestamp(int parameterIndex, Timestamp x), the JDBC driver uses the time zone of the virtual machine to calculate the date and time of the timestamp in that time zone.</li></ul><p>\u901A\u8FC7\u4EE5\u4E0BSQL\u53EF\u4EE5\u5728mysql\u7AEF\u8C03\u67E5\u6570\u636E\u5E93\u6267\u884C\u8FC7\u7A0B</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- \u67E5\u770B \u7CFB\u7EDF\uFF0C\u7A0B\u5E8F\uFF0C\u4F1A\u8BDD\u65F6\u533A</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@system_time_zone</span><span class="token punctuation">,</span>  @<span class="token variable">@global.time_zone</span><span class="token punctuation">,</span> @<span class="token variable">@session.time_zone</span><span class="token punctuation">;</span>
<span class="token comment">-- @@system_time_zone, @@global.time_zone, @@session.time_zone</span>
<span class="token comment">-- UTC, Asia/Shanghai, Asia/Shanghai</span>

<span class="token comment">-- mysql \u6267\u884C\u65E5\u5FD7(UTC)</span>
<span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>win_user<span class="token punctuation">\`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">\`</span>delete_dt<span class="token punctuation">\`</span></span> <span class="token operator">&lt;=</span> <span class="token string">&#39;0999-12-31 16:00:00.0&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- jooq \u7ED1\u5B9A\u65E5\u5FD7(GMT+8)</span>
<span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>win_user<span class="token punctuation">\`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">\`</span>delete_dt<span class="token punctuation">\`</span></span> <span class="token operator">&lt;=</span> <span class="token string">&#39;1000-01-01 00:00:00.0&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- \u6253\u5F00\uFF0C\u65E5\u5FD7\uFF0Cblob\u8981</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_output <span class="token operator">=</span> <span class="token string">&#39;TABLE&#39;</span><span class="token punctuation">;</span><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log <span class="token operator">=</span> <span class="token string">&#39;ON&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>general_log <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_time <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment">-- \u5173\u95ED\uFF0C\u6E05\u9664</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_output <span class="token operator">=</span> <span class="token string">&#39;TABLE&#39;</span><span class="token punctuation">;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log <span class="token operator">=</span> <span class="token string">&#39;OFF&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">truncate</span> <span class="token keyword">table</span> mysql<span class="token punctuation">.</span>general_log<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The session time zone setting affects display and storage of time values that are zone-sensitive. This includes the values displayed by functions such as NOW() or CURTIME(), and values stored in and retrieved from TIMESTAMP columns. Values for TIMESTAMP columns are converted from the session time zone to UTC for storage, and from UTC to the session time zone for retrieval.</p><p>\u5728mysql\u4E2D\uFF0C\u5C3D\u91CF\u4F7F\u7528NOW(fsp)\uFF0C\u56E0\u4E3A\u5176\u77ED\u5C0F\u660E\u786E\u6709\u7F13\u5B58\uFF0C\u5982\u65E0\u5FC5\u987B\u4E0D\u53EF\u4F7F\u7528SYSDATE(fsp)\uFF0C\u53C2\u8003</p>`,14),d={href:"https://dev.mysql.com/doc/refman/8.0/en/time-zone-support.html#time-zone-variables",target:"_blank",rel:"noopener noreferrer"},m=a("https://dev.mysql.com/doc/refman/8.0/en/time-zone-support.html#time-zone-variables"),u={href:"https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_now",target:"_blank",rel:"noopener noreferrer"},k=a("https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_now"),h={href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html",target:"_blank",rel:"noopener noreferrer"},v=a("https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html"),f={href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-datetime-types-processing.html",target:"_blank",rel:"noopener noreferrer"},T=a("https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-datetime-types-processing.html"),_=o('<h2 id="_2h-2-\u6570\u636E\u5E93\u548Cjvm\u65F6\u533A" tabindex="-1"><a class="header-anchor" href="#_2h-2-\u6570\u636E\u5E93\u548Cjvm\u65F6\u533A" aria-hidden="true">#</a> 2H.2.\u6570\u636E\u5E93\u548CJvm\u65F6\u533A</h2><p>\u5E38\u7528\u7684\u65F6\u533A\u67092\u4E2D\u683C\u5F0F\uFF0C\u4E0D\u7BA1\u90A3\u79CD\uFF0C\u90FD\u63A8\u8350\u4F7F\u7528\u7A33\u5B9A\u65F6\u533A\uFF0C\u5982\u653F\u7B56\u4E0D\u4F1A\u53D8\uFF0C\u6CA1\u6709\u590F\u4EE4\u65F6\u3002</p><ul><li>\u5BB9\u6613\u7406\u89E3\u7684ZoneId\u5F62\u5F0F - \u5730\u7406\u57CE\u5E02 Asia/Shanghai\uFF0CAmerica/New_York</li><li>\u89C4\u5219\u7A33\u5B9A\u7684Offset\u5F62\u5F0F - \u76F8\u5BF9\u4E8EUTC\u7684\u65F6\u5DEE\uFF0CUTC\uFF0C+08:00</li></ul><p>wings\u4E2D\u4F7F\u7528DatabaseChecker\u68C0\u67E5\u4EE5\u4E0B\u2461\u2462\u2463\u65F6\u5DEE\u662F\u5426\u4E00\u81F4\uFF0C\u63A8\u8350\u5168\u90E8\u4E00\u81F4\u3002</p><ul><li>\u2460system_time_zone - mysql host machine</li><li>\u2461time_zone - mysql current time zone</li><li>\u2462connectionTimeZone - jdbc connectionTimeZone/serverTimezone</li><li>\u2463jvm TimeZone - jvm DefaultTimeZone</li><li>\u2464host TimeZone - java host machine</li></ul><p>\u5176\u4E2D\u2462\u662Fjdbc\u4E2D\u7279\u6709\u7684\uFF0C\u548Csession timezone\u7C7B\u4F3C\uFF0C\u4F46\u6BD4<code>SET time_zone = timezone</code>\u5F3A\u5927\u3002 \u82E5\u2462\u2463\u4E00\u81F4\u5219\u4E0D\u5F71\u54CD\u4F7F\u7528\uFF0C\u4F46\u82E5\u975Ewings\u73AF\u5883\uFF0C\u5728\u672A\u8BBE\u7F6E\u2462\u5BFC\u81F4mysql\u9ED8\u8BA4\u4F7F\u7528\u2461\u65F6\uFF0C\u5C31\u4F1A\u51FA\u73B0\u65F6\u5DEE\u95EE\u9898\u3002</p><p>\u4F7F\u7528NOW()\u53CATIMESTAMP\u7C7B\u578B\u65F6\u8981\u6CE8\u610F\u65F6\u533A\uFF0C\u4ED6\u4EEC\u53D7\u2462\u7684\u5F71\u54CD\u3002</p><blockquote><p>The session time zone setting affects display and storage of time values that are zone-sensitive. This includes the values displayed by functions such as NOW() or CURTIME(), and values stored in and retrieved from TIMESTAMP columns. Values for TIMESTAMP columns are converted from the session time zone to UTC for storage, and from UTC to the session time zone for retrieval.</p></blockquote><p>\u5C3D\u91CF\u4F7F\u7528 DATE, TIME, DATETIME\u7C7B\u578B\uFF0C\u4ED6\u4EEC\u662F\u65F6\u533A\u65E0\u5173\u7684\u3002</p><blockquote><p>The session time zone setting does not affect values displayed by functions such as UTC_TIMESTAMP() or values in DATE, TIME, or DATETIME columns. Nor are values in those data types stored in UTC; the time zone applies for them only when converting from TIMESTAMP values. If you want locale-specific arithmetic for DATE, TIME, or DATETIME values, convert them to UTC, perform the arithmetic, and then convert back.</p></blockquote><p>\u4EE5\u4E0A\u662F\u6570\u636E\u5E93\u5C42\u9762\u9700\u8981\u6CE8\u610F\u7684\u5730\u65B9\uFF0C\u800C\u4EE5\u4E0B\u4E3Ajdbc\u53CAjava\u4F53\u7CFB\u4E2D\u7684\u6CE8\u610F\u70B9\uFF0C</p><ul><li>connectionTimeZone\u548CforceConnectionTimeZoneToSession\u540C\u65F6\u4F7F\u7528\u3002</li><li>connectionTimeZone\u7684\u503C\uFF0C\u5EFA\u8BAE\u4F7F\u7528offset\u5F62\u5F0F\uFF0C<code>UTC</code>, <code>-40:00</code>, <code>+80:00</code></li><li>\u5728jdbc url\u4E2D\uFF0C\u9700\u8981\u8F6C\u4E49<code>+</code>\uFF0C\u4EE5<code>%2B08:00</code>\u8868\u793A<code>+80:00</code></li><li>\u4E1A\u52A1\u4FA7\u5EFA\u8BAE\u4F7F\u7528ZoneId\u5F62\u5F0F\uFF0Cmysql\u914D\u7F6E\u9879\uFF0C\u5EFA\u8BAE\u662F\u6709offset\u5F62\u5F0F</li></ul><p>connectionTimeZone\u53C2\u6570\uFF088.0\u4E4B\u524D\u662FserverTimezone\uFF09\u53EF\u4EE5\u534F\u8C03\u597Djvm\u548Cmysql\u7684\u65F6\u533A\uFF0C \u5355\u72EC\u4F7F\u7528connectionTimeZone\uFF0C\u4E0D\u4F1A\u6539\u53D8session\u7EA7\u7684time_zone\uFF0C \u9700\u8981\u914D\u5408forceConnectionTimeZoneToSession\uFF0C\u624D\u80FD\u8FBE\u5230session\u548Cjdbc\u4E00\u81F4\u7684\u6548\u679C\u3002</p><p>\u5C3D\u7BA1\u4EE5\u4E0A\u8BBE\u7F6E\u53EF\u4EE5\u6EE1\u8DB3\u9879\u76EE\u8981\u6C42\uFF0C\u4F46\u56E0\u4F5C\u7528\u8303\u56F4\u4E0D\u5982\u7EDF\u4E00\u65F6\u533A\u66F4\u7A33\u5B9A\u53EF\u9760\uFF0C\u4ECD\u5E94\u907F\u514D\u4F7F\u7528\u3002 \u6B64\u5916\u5728mysql\u914D\u989D\u4E2D\uFF0C\u5EFA\u8BAE\u4F7F\u7528offset\u683C\u5F0F\u65F6\u533A\uFF0C\u800C\u4E1A\u52A1\u4FA7\u4F7F\u7528ZoneId\u683C\u5F0F\u3002</p><p>\u5728\u914D\u7F6EJdbcUrl\u65F6\uFF0C\u82E5\u4F7F\u7528<code>+</code>\u65F6\uFF08\u5982\u4E0B\u6240\u793A\uFF09\uFF0C\u4F1A\u53D1\u751FDateTimeException\uFF0C\u56E0\u4E3A\u5728URL\u4E2D<code>+</code>\u6807\u8BC6\u7A7A\u683C\u3002 \u9700\u8981\u8F6C\u4E49\u4E3A<code>%2B</code>\uFF0C\u5373\u6B63\u786E\u7684\u683C\u5F0F\u4E3AconnectionTimeZone=%2B08:00</p><blockquote><p>wings_test?connectionTimeZone=+08:00` Invalid ID for region-based ZoneId, invalid format: 08:00</p></blockquote>',16);function b(g,y){const n=i("ExternalLinkIcon");return c(),l("div",null,[r,e("ul",null,[e("li",null,[e("a",d,[m,s(n)])]),e("li",null,[e("a",u,[k,s(n)])]),e("li",null,[e("a",h,[v,s(n)])]),e("li",null,[e("a",f,[T,s(n)])])]),_])}var q=t(p,[["render",b],["__file","2h-time-zone.html.vue"]]);export{q as default};
