import{_ as i,X as r,Y as u,$ as n,a1 as a,a0 as s,a4 as p,a3 as e,F as o}from"./framework-e2173353.js";const d={},g=n("h1",{id:"_9a4-升迁3-0-2-300手册",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_9a4-升迁3-0-2-300手册","aria-hidden":"true"},"#"),a(" 9A4.升迁3.0.2.300手册")],-1),k=n("p",null,"build版从210升级220，有以下重点不兼容影响。",-1),m=n("li",null,[a("java "),n("code",null,"17"),a(" 取代 "),n("code",null,"11")],-1),v=n("li",null,[a("EE更名，以"),n("code",null,"jakarta"),a("取代 "),n("code",null,"javax")],-1),h=n("code",null,"3.0",-1),b=n("code",null,"2.7",-1),_={href:"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes",target:"_blank",rel:"noopener noreferrer"},f=e(`<h2 id="_9a4-1-修改pom-xml" tabindex="-1"><a class="header-anchor" href="#_9a4-1-修改pom-xml" aria-hidden="true">#</a> 9A4.1.修改pom.xml</h2><p>version变为<code>3.0.2.300-SNAPSHOT</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>wings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.2.300-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a4-2-依赖变更pom-xml" tabindex="-1"><a class="header-anchor" href="#_9a4-2-依赖变更pom-xml" aria-hidden="true">#</a> 9A4.2.依赖变更pom.xml</h2>`,4),x={id:"git-commit-id-plugin",tabindex:"-1"},j=n("a",{class:"header-anchor",href:"#git-commit-id-plugin","aria-hidden":"true"},"#",-1),I={href:"https://github.com/git-commit-id/git-commit-id-maven-plugin",target:"_blank",rel:"noopener noreferrer"},A=e(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pl.project13.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>git-commit-id-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ↑↑变更前↑↑，↓↓变更后↓↓ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.git-commit-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>git-commit-id-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),w={id:"springdoc",tabindex:"-1"},S=n("a",{class:"header-anchor",href:"#springdoc","aria-hidden":"true"},"#",-1),y={href:"https://springdoc.org/v2/",target:"_blank",rel:"noopener noreferrer"},E=e(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-javadoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- ↑↑变更前↑↑，↓↓变更后↓↓ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// import org.springdoc.api.annotations.ParameterObject;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springdoc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ParameterObject</span></span><span class="token punctuation">;</span>
<span class="token comment">// import org.springdoc.core.SpringDocConfiguration;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springdoc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">SpringDocConfiguration</span></span><span class="token punctuation">;</span>
<span class="token comment">// import org.springdoc.core.SpringDocUtils;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springdoc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SpringDocUtils</span></span><span class="token punctuation">;</span>
<span class="token comment">// import org.springdoc.core.customizers.OpenApiCustomiser;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springdoc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>customizers<span class="token punctuation">.</span></span><span class="token class-name">OpenApiCustomizer</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a4-3-javax-to-jakarta-namespace" tabindex="-1"><a class="header-anchor" href="#_9a4-3-javax-to-jakarta-namespace" aria-hidden="true">#</a> 9A4.3.javax to jakarta namespace</h2><p>springboot3生态下，已完成了namespace的变更。wings主要涉及以下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">jakarta<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>PostConstruct</span><span class="token punctuation">;</span>
jakarta<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>*
jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>*
jakarta<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>*
jakarta<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的，可能并非全部替换，需要区分对待和排除，</p><ul><li>并非所有的javax名词空间下都需要替换</li><li>因为间接依赖，可能同时存在java和jakarta包</li><li>多数第三方lib，分别提供了javax和jakarta版</li><li>IDEA提供了迁移工具</li></ul><h2 id="_9a4-4-重做autogen" tabindex="-1"><a class="header-anchor" href="#_9a4-4-重做autogen" aria-hidden="true">#</a> 9A4.4.重做Autogen</h2>`,8),D=n("p",null,"因已关闭JPA注解，现涉及的javax注解如下",-1),N=n("ul",null,[n("li",null,"javax.annotation.processing.Generated (JDK 9+)"),n("li",null,"javax.annotation.Generated (JDK 😎")],-1),P=n("h2",{id:"_9a4-5-add-modules及add-opens",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_9a4-5-add-modules及add-opens","aria-hidden":"true"},"#"),a(" 9A4.5.add-modules及add-opens")],-1),B=n("code",null,"--illegal-access=deny",-1),O=n("code",null,"add-opens",-1),J={href:"http://xn--wingsstarter-0v43a.sh",target:"_blank",rel:"noopener noreferrer"},q=e('<p>已知IDEA中，执行<code>Whole project</code>测试时，未引用surefire的<code>argLine</code>。 其结果是，部分使用反射个功能的测试用例失败。解决办法如下，</p><ul><li>以模块为单位执行，会正确设置<code>argLine</code></li><li>全工程时，需要自行指定<code>add-opens</code>，内容参考<code>argLine</code>。</li></ul><h2 id="_9a4-6-java17的语法特征调整" tabindex="-1"><a class="header-anchor" href="#_9a4-6-java17的语法特征调整" aria-hidden="true">#</a> 9A4.6.java17的语法特征调整</h2>',3),C=n("ul",null,[n("li",null,[a("PatternVariable替换类型强转 "),n("code",null,"instanceof final G g")]),n("li",null,[a("加强版的switch，以箭头表示 "),n("code",null,"case gg -> ;")]),n("li",null,[a("text block 替换字符串拼接 "),n("code",null,'""" """')])],-1),G=e('<ul><li>record - 出小类外，尽量用lombok，拥有更多特性和扩展性</li></ul><h2 id="_9a4-7-重要的直接依赖" tabindex="-1"><a class="header-anchor" href="#_9a4-7-重要的直接依赖" aria-hidden="true">#</a> 9A4.7.重要的直接依赖</h2><ul><li>mirana 2.4.0-SNAPSHOT → 2.4.4-SNAPSHOT</li><li>springdoc 1.6.14 → 2.0.2 <ul><li>org.springdoc:springdoc-openapi-starter-webmvc-ui</li></ul></li><li>boot-admin 2.7.10 → 3.0.0</li><li>sentry 6.12.1 → 6.13.0 <ul><li>sentry-spring-boot-starter-jakarta</li></ul></li><li>flatten-maven-plugin 1.2.7 → 1.3.0</li></ul><h2 id="_9a4-8-wingsboot使用者" tabindex="-1"><a class="header-anchor" href="#_9a4-8-wingsboot使用者" aria-hidden="true">#</a> 9A4.8.Wingsboot使用者</h2><p>本小节适用于以maven的parent形式使用wingsboot的IDEA工程的升级。 建议从<code>2.7.7.220</code>开始升级，否则重新生成jooq代码时，需要临时引入lib。</p><p>开始升级之前，必须注意一下事项，并在一个新的git分支上进行</p><ul><li>一步只进行一个操作，成功后再进行下一步</li><li>每一步成功时，及时提交工作区，以便轻松fallback</li><li>首先保证编译正常，然后再进行运行时测试</li></ul>',7),L={href:"https://github.com/spring-projects-experimental/spring-boot-migrator",target:"_blank",rel:"noopener noreferrer"},R=e('<h3 id="a-修改parent-version" tabindex="-1"><a class="header-anchor" href="#a-修改parent-version" aria-hidden="true">#</a> a.修改parent/version</h3><p>参考 <a href="#9a41%E4%BF%AE%E6%94%B9pomxml">第一小节</a>，使用<code>3.0.2.300-SNAPSHOT</code></p><p>注意，不要修改非必须的dependency版本号，仅修改wings及spring有关的。 凡是不影响编译的业务lib，都不要变动，避免一次修改太多内容，无法划清边界。</p><h3 id="b-设定工程jdk17" tabindex="-1"><a class="header-anchor" href="#b-设定工程jdk17" aria-hidden="true">#</a> b.设定工程JDK17</h3>',4),T={href:"https://adoptium.net/temurin/releases/?version=17",target:"_blank",rel:"noopener noreferrer"},K={href:"https://sdkman.io",target:"_blank",rel:"noopener noreferrer"},H=n("code",null,"sdk install java 17.0.6-tem",-1),V=e(`<p>重新导入maven工程，或在IDEA的菜单中设置，</p><p><code>File</code> | <code>Project Structure</code> (<code>⌘;</code>) | <code>Project</code></p><ul><li>SDK - <code>temurin-17</code></li><li>Language level - <code>SDK default</code></li></ul><h3 id="c-升级名词空间jakarta" tabindex="-1"><a class="header-anchor" href="#c-升级名词空间jakarta" aria-hidden="true">#</a> c.升级名词空间jakarta</h3><p>使用IDEA的重构功能，做jakarta的名词空间迁移，建议先排除jooq自动生成的代码。</p><p><code>Refactor</code> | <code>Migrate Packages and Classes</code> | <code>JavaEE to JakartaEE</code></p><p>若包括jooq代码，<code>javax.annotation.processing.Generated</code> 不要替换。</p><p>迁移结束后，编译错误，应该主要集中在Jooq生成的代码上，解决办法参考下一节。</p><h3 id="d-重新生成jooq代码" tabindex="-1"><a class="header-anchor" href="#d-重新生成jooq代码" aria-hidden="true">#</a> d.重新生成Jooq代码</h3><p>若不是从<code>2.7.7.220</code>开始的升迁，需要临时引入以下lib，重置jooq代码后移除。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- javax.persistence --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>jakarta.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jakarta.persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- javax.validation.constraints --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>jakarta.validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jakarta.validation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>会存在<code>jakarta.annotation.processing.Generated</code>编译错误， 需要替换回<code>javax.annotation.processing.Generated</code>。</p><h3 id="e-升级其他lib版本" tabindex="-1"><a class="header-anchor" href="#e-升级其他lib版本" aria-hidden="true">#</a> e.升级其他lib版本</h3><ul><li>升级过程中，不引起编译错误的lib</li><li>影响编译，但可快速修复或隐藏的</li></ul><p>以上lib之外，建议在上述大变更完成后，逐一升级。</p><h3 id="f-官方检查spring-migrator" tabindex="-1"><a class="header-anchor" href="#f-官方检查spring-migrator" aria-hidden="true">#</a> f.官方检查Spring migrator</h3><p>wings升级后，遵循spring官方的升级手册，并使用自动工具检查。</p>`,17),z={href:"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes",target:"_blank",rel:"noopener noreferrer"},F={href:"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide",target:"_blank",rel:"noopener noreferrer"},M={href:"https://github.com/spring-projects-experimental/spring-boot-migrator",target:"_blank",rel:"noopener noreferrer"},U=n("p",null,"因wings的层叠properties无法被spring识别，需要人工精简，以下为设定部分",-1),W=n("ul",null,[n("li",null,"logging.pattern.dateformat"),n("li",null,"management.endpoints.jmx.exposure.include")],-1);function X(Y,$){const t=o("ExternalLinkIcon"),l=o("RouterLink"),c=o("Badge");return r(),u("div",null,[g,k,n("ul",null,[m,v,n("li",null,[a("boot以"),h,a("取代"),b,a("，"),n("a",_,[a("Release Notes"),s(t)])])]),f,n("h3",x,[j,a(),n("a",I,[a("git-commit-id-plugin"),s(t)])]),A,n("h3",w,[S,a(),n("a",y,[a("springdoc"),s(t)])]),E,n("p",null,[a("参考"),s(l,{to:"/en/9-example/9a.wings-change/9a3.277-220.html"},{default:p(()=>[a("277.220")]),_:1}),a("升级手册。")]),D,N,P,n("p",null,[a("java17中"),B,a("，未"),O,a("会运行时错误。 "),n("a",J,[a("wings的starter.sh"),s(t)]),a("，pom.xml，进行了正确设定，可以直接使用。")]),q,n("p",null,[a("java17提供了比较舒服的语法特征，"),s(c,{type:"tip",vertical:"top"},{default:p(()=>[a("建议")]),_:1}),a("调整")]),C,n("p",null,[a("以下特征"),s(c,{type:"note",vertical:"top"},{default:p(()=>[a("不建议")]),_:1}),a("调整")]),G,n("p",null,[a("可使用"),n("a",L,[a("spring-boot-migrator"),s(t)]),a("做自动升级。")]),R,n("p",null,[a("使用"),n("a",T,[a("Eclipse Temurin™"),s(t)]),a("打包的OpenJDK17， 可以通过"),n("a",K,[a("sdkman"),s(t)]),a("直接安装 "),H]),V,n("ul",null,[n("li",null,[n("a",z,[a("Release Notes"),s(t)]),a(" 检查各项依赖")]),n("li",null,[n("a",F,[a("3.0-Migration-Guide"),s(t)]),a(" 升级事项")]),n("li",null,[n("a",M,[a("spring-boot-migrator"),s(t)]),a(" 自动升级工具")])]),U,W])}const Z=i(d,[["render",X],["__file","9a4.302-300.html.vue"]]);export{Z as default};
