import{_ as p}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as i,c,b as a,e as n,d as s,w as r,f as t}from"./app-RvkmO4dA.js";const d={},u=a("h1",{id:"_9a2-upgrade-2-6-6-210",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_9a2-upgrade-2-6-6-210"},[a("span",null,"9A2.Upgrade 2.6.6.210")])],-1),m=a("p",null,"Upgraded build 201 to 210 with the following major incompatibility,",-1),g=a("li",null,"java 11 instead of 8, compilation and startup parameters changed",-1),k=a("li",null,"boot 2.6 instead of 2.4, webmvc, path matching changed",-1),v=a("li",null,"shardingsphere 5.1 instead of 4.1, better structure",-1),h=a("li",null,[n("flywave "),a("code",null,"__"),n(" instead of "),a("code",null,"$"),n(" to be compatible with some Cloud DB")],-1),b=a("li",null,"swagger springdoc instead of springfox to be compatible with boot2.6",-1),f=a("li",null,"fastjson2 instead of fastjson",-1),_=t(`<h2 id="_9a2-1-modify-pom-xml" tabindex="-1"><a class="header-anchor" href="#_9a2-1-modify-pom-xml"><span>9A2.1.Modify pom.xml</span></a></h2><p>Starting with 210, all artifactId are merged into <code>pro.fessional.wings</code> group. Here is how to modify parent and common dependencies.</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- change [wings-project] to [wings] --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &lt;groupId&gt;pro.fessional&lt;/groupId&gt; --&gt;</span>
    <span class="token comment">&lt;!-- &lt;artifactId&gt;wings-project&lt;/artifactId&gt; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>wings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.6.210-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- change [wings-] from artifactId to groupId [.wings] --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- &lt;groupId&gt;pro.fessional&lt;/groupId&gt; --&gt;</span>
  <span class="token comment">&lt;!-- &lt;artifactId&gt;wings-silencer&lt;/artifactId&gt; --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional.wings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>silencer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${wings.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-2-upgrade-to-java11" tabindex="-1"><a class="header-anchor" href="#_9a2-2-upgrade-to-java11"><span>9A2.2.Upgrade to java11</span></a></h2>`,4),y={href:"https://jdk.java.net/archive/",target:"_blank",rel:"noopener noreferrer"},w={href:"https://asdf-vm.com",target:"_blank",rel:"noopener noreferrer"},A=a("code",null,"JDK8_HOME",-1),E=a("code",null,"JDK11_HOME",-1),x=t("<p>When IDEA or maven starts java program and TestCast, you need to add add-opens or add-exports parameters accordingly</p><ul><li>maven-compiler-plugin - add-exports to compile</li><li>maven-surefire-plugin - add-opens to run</li><li>IDEA run TestCase - get surefire configuration automatically</li><li>IDEA run Java and Boot - manually set the startup parameter template</li></ul><p>Where startup parameters are <code>${wings.java-opens}</code> content, global variables like JAVA_TOOL_OPTIONS are not recommended. You need to set <code>Application</code> and <code>Spring Boot</code> in the <code>Run/Debug Configuration Templates</code> in IDEA.</p><p>References</p>",4),q={href:"https://stackoverflow.com/questions/44056405",target:"_blank",rel:"noopener noreferrer"},T={href:"https://stackoverflow.com/questions/70196098",target:"_blank",rel:"noopener noreferrer"},I=t(`<h2 id="_9a2-3-trace-table-naming" tabindex="-1"><a class="header-anchor" href="#_9a2-3-trace-table-naming"><span>9A2.3.Trace Table Naming</span></a></h2><p>Mainly log table, changed from dollar to double underscore style, trigger suffix to prefix.</p><ul><li>log table changed from <code>table$log</code> to <code>table__</code></li><li>trigger from <code>table$ai</code> to <code>ai__table</code></li></ul><p>The operation steps are as follows.</p><ul><li>Execute JournalManager.manageTriggers(table, true) to delete the old trigger</li><li>execute JournalManager.checkAndInitDdl(table, cid) to replace the old config with the new one</li><li>Rename journal table manually</li><li>Execute JournalManager.publishInsert/Update/Delete(table, true, cid) to generate a new trigger</li></ul><p>If the data is mysql8 and meets to the wings specification, you can use the following sql test.</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
  TABLE_NAME <span class="token keyword">as</span> TRACE_TBL<span class="token punctuation">,</span>
  <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>TABLE_NAME<span class="token punctuation">,</span><span class="token string">&#39;$log&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> PLAIN_TBL<span class="token punctuation">,</span>
  CONCAT<span class="token punctuation">(</span><span class="token string">&#39;ALTER TABLE &#39;</span><span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token string">&#39; RENAME TO &#39;</span><span class="token punctuation">,</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> <span class="token string">&#39;$log&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;__&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;;;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> RENAME_DDL
<span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">TABLES</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">=</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">AND</span> table_name <span class="token operator">REGEXP</span> <span class="token string">&#39;\\\\$log&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span>
  TRIGGER_NAME <span class="token keyword">as</span> OLD_NAME<span class="token punctuation">,</span>
  REGEXP_REPLACE<span class="token punctuation">(</span>TRIGGER_NAME<span class="token punctuation">,</span><span class="token string">&#39;^(.+)\\\\$(.+)$&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;$2__$1&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> NEW_NAME<span class="token punctuation">,</span>
  CONCAT<span class="token punctuation">(</span><span class="token string">&#39;DROP TRIGGER IF EXISTS &#39;</span><span class="token punctuation">,</span>TRIGGER_NAME<span class="token punctuation">,</span><span class="token string">&#39;;;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> DROP_DDL<span class="token punctuation">,</span>
  <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">&#39;CREATE TRIGGER \`&#39;</span><span class="token punctuation">,</span> REGEXP_REPLACE<span class="token punctuation">(</span>TRIGGER_NAME<span class="token punctuation">,</span><span class="token string">&#39;^(.+)\\\\$(.+)$&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;$2__$1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;\` &#39;</span><span class="token punctuation">,</span>
    ACTION_TIMING<span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> EVENT_MANIPULATION<span class="token punctuation">,</span> <span class="token string">&#39; ON \`&#39;</span><span class="token punctuation">,</span> EVENT_OBJECT_TABLE<span class="token punctuation">,</span> <span class="token string">&#39;\` FOR EACH ROW &#39;</span><span class="token punctuation">,</span>
    ACTION_STATEMENT<span class="token punctuation">,</span> <span class="token string">&#39;;;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;$log&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;__&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CREATE_DDL
<span class="token keyword">FROM</span>
  INFORMATION_SCHEMA<span class="token punctuation">.</span>TRIGGERS
<span class="token keyword">WHERE</span>
  EVENT_OBJECT_SCHEMA <span class="token operator">=</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">-- Copy the above DROP_DDL, RENAME_DDL, CREATE_DDL and execute them in order.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-4-remove-lombok-s-var" tabindex="-1"><a class="header-anchor" href="#_9a2-4-remove-lombok-s-var"><span>9A2.4.Remove lombok&#39;s var</span></a></h2><p>import lombok.var;</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.java&#39;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> fl<span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/import lombok.var;//g&#39;</span> <span class="token variable">$fl</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-5-swagger3-0-annotation" tabindex="-1"><a class="header-anchor" href="#_9a2-5-swagger3-0-annotation"><span>9A2.5.Swagger3.0 Annotation</span></a></h2>`,11),R={href:"https://springdoc.org/#migrating-from-springfox",target:"_blank",rel:"noopener noreferrer"},j=t(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># check swagger2 annotation</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.java&#39;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> fl<span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token function">grep</span> <span class="token string">&#39;import io.swagger.annotations&#39;</span> <span class="token variable">$fl</span> <span class="token operator">&gt;&gt;</span> /tmp/swagger.log
<span class="token keyword">done</span>
<span class="token function">sort</span> /tmp/swagger.log <span class="token operator">|</span> <span class="token function">uniq</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /tmp/swagger.log

<span class="token comment"># Replace common tags and modify compilation errors caused by formatting deviations</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.java&#39;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> fl<span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/import io.swagger.annotations.ApiModel;/import io.swagger.v3.oas.annotations.media.Schema;/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/import io.swagger.annotations.ApiModelProperty;/import io.swagger.v3.oas.annotations.media.Schema;/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/import io.swagger.annotations.Api;/import io.swagger.v3.oas.annotations.tags.Tag;/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/import io.swagger.annotations.ApiOperation;/import io.swagger.v3.oas.annotations.Operation;/g&#39;</span> <span class="token variable">$fl</span>

<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/@ApiModel\\((.*)\\)/@Schema(description = \\1)/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/@ApiModelProperty\\((.*)\\)/@Schema(description = \\1)/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/@Api\\((.*)\\)/@Tag(name = \\1)/g&#39;</span> <span class="token variable">$fl</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;&#39;</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;s/@ApiOperation\\((.*)\\)/@Operation(summary = \\1)/g&#39;</span> <span class="token variable">$fl</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-6-upgrade-to-mysql8" tabindex="-1"><a class="header-anchor" href="#_9a2-6-upgrade-to-mysql8"><span>9A2.6.Upgrade to Mysql8</span></a></h2>`,2),C={href:"https://dev.mysql.com/doc/refman/8.0/en/upgrade-binary-package.html",target:"_blank",rel:"noopener noreferrer"},O={href:"https://dev.mysql.com/blog-archive/inplace-upgrade-from-mysql-5-7-to-mysql-8-0",target:"_blank",rel:"noopener noreferrer"},S={href:"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-utilities-upgrade.html",target:"_blank",rel:"noopener noreferrer"},N=t(`<p>Wings project use jooq, avoid complex sql, only sql basic features, generally no compatibility. Can use mysql shell to check,</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Option 1, need to install mysql shell</span>
mysqlsh -- util checkForServerUpgrade root@wings-sql-dev5:3306 --target-version<span class="token operator">=</span><span class="token number">8.0</span>.26 --output-format<span class="token operator">=</span>JSON
<span class="token comment"># Option 2, use mysql-client 8.0</span>
mysqlcheck <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token parameter variable">--protocol</span><span class="token operator">=</span>tcp <span class="token parameter variable">-h</span> kite-sql-dev5 --all-databases --check-upgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In-Place upgrade, that is, use the original data directory of 5.7, start mysql8 directly, and adjust its data structure automatically. Simple database (single machine, single container) is recommended, such as using docker to start mysql8.0, and check the following 2 items to upgrade automatically.</p><ul><li>Its data points to mysql5.7&#39;s data.</li><li>Configure upgrade=FORCE in mysqld</li></ul><p>Logical upgrade, meaning dump first and then restore, is recommended for complex databases (cloud, master-slave, cluster). When restoring directly from 5.7 FullDump to 8.0, you need to set the permission of <code>upgrade=FORCE</code> to full last upgrade. Otherwise, the user will be able to log in, but Access denied, so that the support users and features are not good.</p><p>Therefore, it is recommended to dump business users and datas separately on machines with mysql8 client, and then restore.</p><ul><li>dump mysql5.7 business user, business data</li><li>restore mysql 8.0 user first then data</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Generate config file</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span>kite-sql.cnf<span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[client]
protocol=tcp
port=3306
user=trydofor
password=moilioncircle
EOF</span>

<span class="token comment"># Use mysqlpump to support more options, all using mysql8&#39;s client</span>
mysqlpump --defaults-extra-file<span class="token operator">=</span>kite-sql.cnf <span class="token parameter variable">-h</span> kite-sql-dev5 <span class="token punctuation">\\</span>
--all-databases --exclude-databases<span class="token operator">=</span>information_schema,mysql,performance_schema,sys <span class="token punctuation">\\</span>
--set-gtid-purged<span class="token operator">=</span>OFF <span class="token operator">&gt;</span> mysql-5.7-data.sql

mysqlpump --defaults-extra-file<span class="token operator">=</span>kite-sql.cnf <span class="token parameter variable">-h</span> kite-sql-dev5 <span class="token punctuation">\\</span>
<span class="token parameter variable">--users</span> --exclude-users<span class="token operator">=</span>root,%backup <span class="token punctuation">\\</span>
--exclude-databases<span class="token operator">=</span>% --set-gtid-purged<span class="token operator">=</span>OFF <span class="token operator">&gt;</span> mysql-5.7-user.sql

<span class="token builtin class-name">echo</span> <span class="token string">&quot;flush privileges;&quot;</span> <span class="token operator">&gt;&gt;</span> mysql-5.7-user.sql

<span class="token comment"># If the dump is not ignoring innodb_*_status, you need to use --force to skip the error</span>
<span class="token function">cat</span> mysql-5.7-user.sql mysql-5.7-data.sql <span class="token punctuation">\\</span>
<span class="token operator">|</span> mysql --defaults-extra-file<span class="token operator">=</span>kite-sql.cnf <span class="token parameter variable">-h</span> kite-sql-dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-7-damaging-impact" tabindex="-1"><a class="header-anchor" href="#_9a2-7-damaging-impact"><span>9A2.7.Damaging Impact</span></a></h2><ul><li>wings-project is no longer dependent on devtools, and projects using it as a parent must add the dependency.</li><li>Changed the url permission config of warlock security from list to map, clarifying the override relationship from loose to strict.</li><li>Mirana rewrite DateLocaling method name, if compile error, you can rely on the parameter signature, bulk replacement method name.</li><li>Warlock1SchemaManager rename methods</li><li>Rename @JsonI18nString to @AutoI18nString</li></ul><h2 id="_9a2-8-jooqdao-incompatible" tabindex="-1"><a class="header-anchor" href="#_9a2-8-jooqdao-incompatible"><span>9A2.8.JooqDao Incompatible</span></a></h2><p>The previous static reference is no longer recommended.</p><ul><li>val t = dao.getTable()</li><li>val a = dao.getAlias()</li></ul><p>It is recommended to define local variables with dao.getTable and getAlias instead of static global tables. The previous fetch(Condition) signature can be changed to the following form</p><ul><li>fetch(Table, Condition)</li><li>fetch(t -&gt; Fn.of(t.Id.eq(1L)))</li></ul><h2 id="_9a2-9-external-api-compatibility" tabindex="-1"><a class="header-anchor" href="#_9a2-9-external-api-compatibility"><span>9A2.9.External Api Compatibility</span></a></h2><ul><li><p>mysql8 does not have password function, use the following combination to replace it. SELECT CONCAT(&#39;*&#39;, UPPER(SHA1(UNHEX(SHA1(&#39;trydofor&#39;))))), password(&#39;trydofor&#39;);</p></li><li><p>Adjustment of DateTimeFormatter in java11, such as Offset X&#39;s original <code>XXX</code> cannot represent <code>XXXX</code> and <code>XXXXX</code>, and so on.</p></li><li><p>fastjson2, you should simply replace <code>com.alibaba.fastjson.</code> with <code>com.alibaba.fastjson2.</code>. If the dependency on fastjson is too heavy and complex, please check the quality of the project and make sure the usage is safe.</p></li></ul><h2 id="_9a2-a-anthn-typo" tabindex="-1"><a class="header-anchor" href="#_9a2-a-anthn-typo"><span>9A2.A.Anthn Typo</span></a></h2><p>Execute <code>2021-09-18v01</code> via Flywave to fix <code>win_user_anthn</code> typo error</p><h3 id="execute-sql-script" tabindex="-1"><a class="header-anchor" href="#execute-sql-script"><span>Execute Sql Script</span></a></h3><p>If there is no shard table and no trace table, you can execute the upgrade sql manually. Otherwise, it is recommended to use flywave to execute it to avoid missing.</p><ul><li>rename win_user_anthn</li><li>update sys_light_sequence</li><li>update shard table_#</li><li>update trace table$log</li><li>update triggers</li></ul><h3 id="replace-java-file" tabindex="-1"><a class="header-anchor" href="#replace-java-file"><span>Replace Java File</span></a></h3><p>Whole project java file, replace the following strings,</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/user_anthn/user_authn/g&#39;</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/UserAnthn/UserAuthn/g&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-b-split-warlockbond" tabindex="-1"><a class="header-anchor" href="#_9a2-b-split-warlockbond"><span>9A2.B.Split WarlockBond</span></a></h2><p>The default database implementation of user privileges, split into the warlock-bond project.</p><ul><li>if not needed, dependency warlock</li><li>otherwise, dependency warlock-bond</li></ul><p>Also add <code>2020-10-23v01</code> to remove flywave-fit warnings.</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">IGNORE</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_schema_version<span class="token punctuation">\`</span></span> 
<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>revision<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">\`</span>commit_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">\`</span>apply_dt<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">\`</span>comments<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">\`</span>upto_sql<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">\`</span>undo_sql<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2020102302</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-c-split-codegen" tabindex="-1"><a class="header-anchor" href="#_9a2-c-split-codegen"><span>9A2.C.Split CodeGen</span></a></h2><p>code generation tools, split into separate projects, faceless-codegen and warlock-codegen, respectively. In practice, the direct dependency on warlock-codegen can be used, the sample maven configuration is as follows</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional.wings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>warlock-codegen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-d-i18n-change" tabindex="-1"><a class="header-anchor" href="#_9a2-d-i18n-change"><span>9A2.D.I18n Change</span></a></h2><p>The semantics of <code>ukey</code> in <code>sys_standard_i18n</code> is to constrain unique data or enum class location members</p><ul><li><code>id</code> type - <code>id.</code> + id</li><li><code>code</code> type - type + <code>.</code> + code</li><li>java enum, consists of package, class, member name</li></ul><p>changes include, data records and generated code of I18n,</p><ul><li>replace the data, such as 2019-05-21v01-enum-i18n.sql</li><li>regenerate the template code, such as StandardLanguage</li></ul><h2 id="_9a2-e-properties-change" tabindex="-1"><a class="header-anchor" href="#_9a2-e-properties-change"><span>9A2.E.Properties Change</span></a></h2><h3 id="wings-monitor-79-properties" tabindex="-1"><a class="header-anchor" href="#wings-monitor-79-properties"><span>wings-monitor-79.properties</span></a></h3><ul><li>change <code>report-keyword</code> to <code>notice-keyword</code></li></ul>`,41);function D(M,L){const l=o("RouteLink"),e=o("ExternalLinkIcon");return i(),c("div",null,[u,m,a("ul",null,[g,k,v,h,b,f,a("li",null,[n("check "),s(l,{to:"/9-example/9a.wings-change/9a0.notable.html"},{default:r(()=>[n("wings notable changelog")]),_:1})])]),_,a("p",null,[n("The current java11 used is "),a("a",y,[n("openjdk build 11.0.2+9"),s(e)]),n(". It is recommended to manage the java8 and java11 environment with "),a("a",w,[n("asdf"),s(e)]),n(" and set the "),A,n(" and "),E,n(" variables in the shell.")]),x,a("ul",null,[a("li",null,[a("a",q,[n("What's the difference between --add-exports and --add-opens ..."),s(e)])]),a("li",null,[a("a",T,[n("How can I specify --add-opens from a project level ..."),s(e)])])]),I,a("p",null,[n("springdoc fully uses OpenApi/Swagger3.0, so springfox's Swagger2.0 annotations need to be replaced. See "),a("a",R,[n("https://springdoc.org/#migrating-from-springfox"),s(e)]),n(" for details")]),j,a("ul",null,[a("li",null,[a("a",C,[n("Logical Upgrade"),s(e)])]),a("li",null,[a("a",O,[n("In-Place Upgrade"),s(e)])]),a("li",null,[a("a",S,[n("mysql shell"),s(e)])])]),N])}const U=p(d,[["render",D],["__file","9a2.266-210.html.vue"]]),G=JSON.parse(`{"path":"/9-example/9a.wings-change/9a2.266-210.html","title":"9A2.Upgrade 2.6.6.210","lang":"en-US","frontmatter":{"isOriginal":true,"icon":"change","category":["Practice","Upgrade"],"description":"9A2.Upgrade 2.6.6.210 Upgraded build 201 to 210 with the following major incompatibility, java 11 instead of 8, compilation and startup parameters changed boot 2.6 instead of 2....","GIT_REPO_HEAD":"2024-02-16 3fdd45de377187002fd49a06332fb14346c10eb1","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://wings.fessional.pro/zh/9-example/9a.wings-change/9a2.266-210.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/9-example/9a.wings-change/9a2.266-210.html"}],["meta",{"property":"og:site_name","content":"WingsBoot Win Sprint"}],["meta",{"property":"og:title","content":"9A2.Upgrade 2.6.6.210"}],["meta",{"property":"og:description","content":"9A2.Upgrade 2.6.6.210 Upgraded build 201 to 210 with the following major incompatibility, java 11 instead of 8, compilation and startup parameters changed boot 2.6 instead of 2...."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-12-21T01:07:57.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2023-12-21T01:07:57.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"9A2.Upgrade 2.6.6.210\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-12-21T01:07:57.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"9A2.1.Modify pom.xml","slug":"_9a2-1-modify-pom-xml","link":"#_9a2-1-modify-pom-xml","children":[]},{"level":2,"title":"9A2.2.Upgrade to java11","slug":"_9a2-2-upgrade-to-java11","link":"#_9a2-2-upgrade-to-java11","children":[]},{"level":2,"title":"9A2.3.Trace Table Naming","slug":"_9a2-3-trace-table-naming","link":"#_9a2-3-trace-table-naming","children":[]},{"level":2,"title":"9A2.4.Remove lombok's var","slug":"_9a2-4-remove-lombok-s-var","link":"#_9a2-4-remove-lombok-s-var","children":[]},{"level":2,"title":"9A2.5.Swagger3.0 Annotation","slug":"_9a2-5-swagger3-0-annotation","link":"#_9a2-5-swagger3-0-annotation","children":[]},{"level":2,"title":"9A2.6.Upgrade to Mysql8","slug":"_9a2-6-upgrade-to-mysql8","link":"#_9a2-6-upgrade-to-mysql8","children":[]},{"level":2,"title":"9A2.7.Damaging Impact","slug":"_9a2-7-damaging-impact","link":"#_9a2-7-damaging-impact","children":[]},{"level":2,"title":"9A2.8.JooqDao Incompatible","slug":"_9a2-8-jooqdao-incompatible","link":"#_9a2-8-jooqdao-incompatible","children":[]},{"level":2,"title":"9A2.9.External Api Compatibility","slug":"_9a2-9-external-api-compatibility","link":"#_9a2-9-external-api-compatibility","children":[]},{"level":2,"title":"9A2.A.Anthn Typo","slug":"_9a2-a-anthn-typo","link":"#_9a2-a-anthn-typo","children":[{"level":3,"title":"Execute Sql Script","slug":"execute-sql-script","link":"#execute-sql-script","children":[]},{"level":3,"title":"Replace Java File","slug":"replace-java-file","link":"#replace-java-file","children":[]}]},{"level":2,"title":"9A2.B.Split WarlockBond","slug":"_9a2-b-split-warlockbond","link":"#_9a2-b-split-warlockbond","children":[]},{"level":2,"title":"9A2.C.Split CodeGen","slug":"_9a2-c-split-codegen","link":"#_9a2-c-split-codegen","children":[]},{"level":2,"title":"9A2.D.I18n Change","slug":"_9a2-d-i18n-change","link":"#_9a2-d-i18n-change","children":[]},{"level":2,"title":"9A2.E.Properties Change","slug":"_9a2-e-properties-change","link":"#_9a2-e-properties-change","children":[{"level":3,"title":"wings-monitor-79.properties","slug":"wings-monitor-79-properties","link":"#wings-monitor-79-properties","children":[]}]}],"git":{"createdTime":1680228107000,"updatedTime":1703120877000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":7}]},"readingTime":{"minutes":4.85,"words":1455},"filePathRelative":"9-example/9a.wings-change/9a2.266-210.md","localizedDate":"March 31, 2023","autoDesc":true}`);export{U as comp,G as data};
