import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as a,f as o}from"./app-b67efd75.js";const t={},s=o(`<h1 id="b3-syntax-summary" tabindex="-1"><a class="header-anchor" href="#b3-syntax-summary" aria-hidden="true">#</a> B3.Syntax Summary</h1><p>In scenarios where templates are used, it is particularly desirable that the <code>template syntax</code> does not destroy the syntax of the <code>target file</code> and that the two coexist without interference.</p><p>For example, when generating java with velocity, I hope the template can be checked and highlighted in both velocity and java syntax. when generating html, the template should be able to preview directly in the browser without breaking the html syntax.</p><ul><li><code>template syntax</code> - syntax of template engine, such as FreeMarker, Velocity.</li><li><code>target syntax</code> - aka. <code>native syntax</code>, syntax of the target file, such as java, html.</li><li><code>meepo syntax</code> - simple markup directives that use the comments of the target syntax to translate the template.</li><li>All text order is left-to-right, right-to-left language is not supported.</li></ul><p>The directive is made by <code>comment</code> of the <code>native syntax</code> and the replacement is processed line by line to output the <code>underlay template (backend)</code>.</p><p>The processing of the <code>native syntax</code> is divided into two processes, <code>parse</code> and <code>merge</code>, and the lookup in parsing depends on regular expressions. When merging, except for <code>RNA</code>, it is output directly, and the effectiveness is equal to <code>StringBuilder.append</code>.</p><p>There is no complex <code>flow control</code> and <code>execute function</code> in RNA, so <code>parsing</code> once and the subsequent <code>merging</code> is very efficient.</p><ul><li>Without <code>RNA</code>, equivalent to a static string for idempotent operations, merge only once, used directly afterwards</li><li><code>RNA</code> relies on an <code>execution engine</code>, equivalent to <code>Map</code> + <code>StringBuilder</code> except for dynamic language</li><li><code>java</code> execution engine, dynamically compiled to bytecode, equal to native java class after first compilation</li><li><code>StringBuilder</code> pre-calculates the length to avoid expansion copying in the process</li></ul><h2 id="b3-1-template-features" tabindex="-1"><a class="header-anchor" href="#b3-1-template-features" aria-hidden="true">#</a> B3.1.Template Features</h2><p>There are some basic concepts and conventions in Meepo syntax, as follows,</p><ul><li><code>blank</code> - one <code>0x20</code> or <code>0x09</code>, i.e. space or <code>\\t</code></li><li><code>alphanum</code> - <code>[a-zA-z0-9]</code>, letters and numbers, case-sensitive</li><li><code>native comment</code> - comments of native language, e.g., <code>//</code>, <code>/*</code> and <code>*/</code></li><li><code>directive</code> - special annotation in Meepo, such as a prefix</li><li><code>DNA</code> - Defined Native Annotation</li><li><code>RNA</code> - Runnable Native Annotation</li><li><code>? +*</code> - <code>[0,1]</code>, <code>[1,∞)</code>, <code>[0,∞)</code>, respectively</li><li><code>directive line</code> - directive line is only parsed by <code>Meepo</code> and invisible in merge</li><li><code>line</code> - refers to <code>[^\\n]\\n</code> or <code>[^\\n]$</code> format</li></ul><p>For simplicity, the <code>native comment</code> + <code>blank</code> before the <code>directive</code> is omitted in the following,</p><ul><li><code>HI-MEEPO</code> Hi! Miepo, define <code>navite comment</code> for subsequent parsing</li><li><code>DNA:SET</code> Set replacement, define a substitution and its scope</li><li><code>DNA:END</code> End effect, stop acting when or where</li><li><code>DNA:BKB</code> Effect Immunity, the region before <code>END</code> is not parsed</li><li><code>DNA:RAW</code> Native raw string, after execution, output the raw string behind it</li><li><code>DNA:SON</code> Sub-template, used as a component to import other templates during parsing</li><li><code>RNA:PUT</code> Put variable, execute the <code>execute body</code> and store the result in the environment</li><li><code>RNA:USE</code> Use variable, use the built-in or <code>PUT</code>ed variable in environment</li><li><code>RNA:RUN</code> Execute every time, executes <code>function body</code> every time, such as counter</li><li><code>RNA:WHEN</code> Conditional execution, combined into if-elseif-else logic blocks</li><li><code>RNA:EACH</code> Loop execution, loop in an array or collection</li><li><code>RNA:ELSE</code> Else condition, the else branch for <code>WHEN</code> and <code>EACH</code></li><li><code>RNA:DONE</code> Stop executing, ends the scope of <code>WHEN</code> and <code>EACH</code></li></ul><p>Always use <code>\\n</code> as <code>line terminators</code> to break line, even if <code>\\r\\n</code> in window is processed as <code>\\n</code>. In the single line comment style that ends with<code>\\n</code>, the<code>\\n</code> is considered as a syntax terminator, and will not be output in the merge.</p><p>Some RegRxp background knowledge is required, as Java&#39;s RegExp is used to parse the template.</p><ul><li>In searching, <code>.^$?+*{}()[]\\|</code> is always misused, no need to escape some chars in <code>[]</code></li><li>In replacement, <code>\\</code> is mainly used as a <code>back reference</code>, and some of the <code>()</code> combinations have special meanings.</li></ul><p>The regular compile options are <code>UNIX_LINES</code> and <code>MULTILINE</code>, set by the <code>embedded flag</code>,</p><ul><li><code>(?idmsuxU-idmsuxU)</code> Nothing, but turns match <code>flags</code> on/off</li><li><code>(?idmsux-idmsux:X)</code> X, as a non-capturing group with the given <code>flags</code> on/off</li><li>i Pattern.CASE_INSENSITIVE Not case-sensitive, default off</li><li>d Pattern.UNIX_LINES Only <code>\\n</code> as <code>line terminators</code>, default on</li><li>m Pattern.MULTILINE <code>^</code> and <code>$</code> will match <code>line terminators</code>, default on</li><li>s Pattern.DOTTAL <code>.</code> match <code>line terminators</code>, default off</li><li>u Pattern.UNICODE_CASE Unicode-aware case folding, default off</li><li>x Pattern.COMMENTS whitespace and comments in pattern, default off</li><li>U Pattern.UNICODE_CHARACTER_CLASS, default off</li></ul><h2 id="b3-2-hi-meepo-hi-meepo" tabindex="-1"><a class="header-anchor" href="#b3-2-hi-meepo-hi-meepo" aria-hidden="true">#</a> B3.2.HI-MEEPO Hi! Meepo</h2><p>Syntax: <code>comment head</code> <code>blank</code>+ <code>HI-MEEPO</code> <code>!</code>? <code>blank</code>+ <code>comment tail</code>?</p><p>Define <code>comment</code> and identify this file as the <code>native</code> file that <code>Meepo</code> will parse.</p><ul><li><code>comment head</code> - The first part of a single or multi comment, the previous non-<code>blank</code> string</li><li><code>HI-MEEPO</code> - The strange name (hi meepo) is to avoid repetition and escape</li><li><code>!</code> - The <code>!</code> preserves the <code>blank</code> before and after the directive, explained later</li><li><code>comment tail</code> - The end of multi-line comment, the latter non-<code>blank</code> string</li></ul><p><code>Hi! Meepo</code> must be on a separate line, and using <code>blank</code> can improve the readability. Similar to using <code>DELIMITER</code> in sql to define the terminator, for example,</p><ul><li>java - <code>// HI-MEEPO</code>, <code>//</code> is comment</li><li>java - <code>/* HI-MEEPO */</code>, <code>/*</code> and <code>*/</code> are comment</li><li>sql - <code>-- HI-MEEPO</code>, <code>--</code> is comment</li><li>bash - <code># HI-MEEPO</code>, <code>#</code> is comment</li><li>html - <code>&lt;!-- HI-MEEPO --&gt;</code>, <code>&lt;!--</code> and <code>--&gt;</code> are comment</li></ul><p>Note: that the <code>comment head</code> can have repeated letters, and Meepo only handles the repetition of the same character, for example,</p><ul><li><code>/*</code> - <code>/***** DNA:RAW</code>, invalid, nothing to do</li><li><code>//</code> - <code>////// DNA:RAW</code>, valid, handle the repeats</li><li><code>#</code> - <code>##### DNA:RAW</code>, valid, handle the repeats</li></ul><p>For the following text (DNA and RNA) parsing, there are 2 types of parsing, line parsing and block parsing, rules as follows,</p><ul><li><code>HI-MEEPO</code> is always a line parser and must occupy a separate line.</li><li><code>single line comment</code> style Meepo is parsed line by line.</li><li><code>Multi-line comment</code> style Meepo is read across lines and parsed by block.</li><li>Parsing is not always done line by line, so<code>^</code> and <code>$</code> are not always at the beginning and end of a line in the regular matching.</li></ul><p><code>HI-MEEPO!</code> and <code>HI-MEEPO</code> handle the first <code>blank</code> of the directive line according to the following rules,</p><ul><li>Without <code>!</code> and the whole line directive will ignore its line in the output, i.e. the first <code>\\n</code> after the directive line.</li><li>With <code>!</code>, only the directive between the head and tail of the Meepo is processed, and the blanks before and after are preserved.</li><li><code>DNA:RAW</code> is special, the <code>!</code> has no effect on it, it keeps its outside and removes the first blank inside it.</li><li>In <code>@&lt;!--_DNA:RAW_SUPER_--&gt;@</code>, <code>@</code> and <code>_</code> denote reserved and removed blanks, respectively.</li></ul><p>In subsequent examples, <code>// HI-MEEPO</code> is used as an example, but omitted.</p><h2 id="b3-3-factory-dna-static-replacement" tabindex="-1"><a class="header-anchor" href="#b3-3-factory-dna-static-replacement" aria-hidden="true">#</a> B3.3.Factory DNA, Static Replacement</h2><p>DNA is like a factory director that defines replacement directives for efficient static text replacement at parse time.</p><h2 id="b3-4-dna-set-setting-replacement" tabindex="-1"><a class="header-anchor" href="#b3-4-dna-set-setting-replacement" aria-hidden="true">#</a> B3.4.DNA:SET Setting Replacement</h2><p>Syntax: <code>DNA:SET</code> <code>blank</code>+ <code>delim</code> <code>find</code> <code>delim</code> <code>repl</code> <code>delim</code> <code>effect</code>?</p><p>Replaces the pattern matching string within a specified scope or times.</p><ul><li><code>delim</code> - <code>delimiter</code>, the 1st non-(<code>blank</code>, <code>!</code>, <code>alphanum</code>) 1-2byte char, such as <code>/</code></li><li><code>find</code> - RexExp pattern (without <code>delim</code>), refer to <code>backreference</code> if grouping exists</li><li><code>find</code> is empty, this <code>SET</code> is ignored.</li><li><code>repl</code> - <code>replace</code>, string (without <code>delim</code>), refer to <code>backreference</code> if grouping exists</li><li><code>repl</code> is empty, it means delete, i.e. replace with empty</li><li><code>effect</code> - The number of times to take effect, i.e. when/where to stop, not <code>blank</code></li></ul><p>The <code>backreference</code> refers to the case where there is <code>()</code> in <code>find</code> or the <code>\\1</code> in<code>repl</code>. This affects the delimiter of the find/replace string, and also avoid writing complex expressions with the following convention rules.</p><ul><li><p>If there is no group in <code>find</code>, use group(0), i.e., match all.</p></li><li><p>If <code>find</code> has group, take the first <code>(</code>, i.e. group(1) content.</p></li><li><p>If <code>((A)(B(C))</code>, count <code>(</code> in the order from left to right.</p><ul><li>group(1) - ((A)(B(C)))</li><li>group(2) - (A)</li><li>group(3) - (B(C))</li><li>group(4) - (C)</li></ul></li><li><p><code>times</code>, values separated by <code>,</code> or closed range with <code>-</code>, e.g. <code>1-3,15</code>.</p></li><li><p><code>named</code>, infinite times that can be terminated by <code>END</code>.</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:SET /false/{{user.male}}/</span>
<span class="token keyword">var</span> isMale <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">/* Replace only false in above line with the variable user.male. the output is :
var isMale = {{user.male}};
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-5-dna-end-end-effect" tabindex="-1"><a class="header-anchor" href="#b3-5-dna-end-end-effect" aria-hidden="true">#</a> B3.5.DNA:END End Effect</h2><p>Syntax: <code>DNA:END</code> (<code>blank</code>+ <code>effect</code>)+</p><p>End the scope of <code>effect</code>s created by directives, such as the named scope of <code>SET</code>.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:SET /1010100/{{id}}/id</span>
<span class="token comment">// DNA:SET /&quot;(VAR)&quot;/{{desc}}/1</span>
<span class="token comment">// DNA:SET /VAR/{{info}}/2</span>
<span class="token constant">SUPER</span><span class="token punctuation">(</span><span class="token number">1010100</span><span class="token punctuation">,</span> <span class="token string">&quot;ConstantEnumTemplate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// DNA:END id</span>
<span class="token comment">/* Defines named id, desc&#39;s group(1), info&#39;s 2 matches. the output is :
SUPER({{id}}, &quot;ConstantEnumTemplate&quot;, &quot;{{desc}}&quot;, &quot;{{info}}&quot;)
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-6-dna-bkb-effect-immunity" tabindex="-1"><a class="header-anchor" href="#b3-6-dna-bkb-effect-immunity" aria-hidden="true">#</a> B3.6.DNA:BKB Effect Immunity</h2><p>Syntax: <code>DNA:BKB</code> <code>blank</code>+ <code>effect</code></p><p>Define a <code>named</code> global effect inmmuity scope that can be ended by <code>END</code>, and the text and directive within it will not be processed.</p><ul><li>text - any text that is not Meppo directive</li><li>directive - treated as text except for the END which corresponds to the current BKB.</li><li>There can only be one BKB currently at a time.</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:BKB KING</span>
<span class="token comment">// DNA:SET /&quot;(VAR)&quot;/desc/1</span>
<span class="token constant">SUPER</span><span class="token punctuation">(</span><span class="token number">1010100</span><span class="token punctuation">,</span> <span class="token string">&quot;ConstantEnumTemplate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// DNA:END KING</span>
<span class="token comment">/* ignore the SET directive, the output is :
// DNA:SET /&quot;(VAR)&quot;/desc/1
SUPER(1010100, &quot;ConstantEnumTemplate&quot;, &quot;VAR&quot;, &quot;VAR&quot;)
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-7-dna-raw-native-raw-string" tabindex="-1"><a class="header-anchor" href="#b3-7-dna-raw-native-raw-string" aria-hidden="true">#</a> B3.7.DNA:RAW Native Raw String</h2><p>Syntax: <code>DNA:RAW</code> <code>blank</code>+ <code>raw string</code></p><p>Define a <code>template</code> with comment syntax to compensate for cases where the <code>native</code> syntax is not supported. The use of single-line comment is simple and clear. and the use of multi-line comment to keep only the content between head and taili.</p><p>The effect is to remove the <code>comment head</code>, <code>DNA:RAW</code>, <code>comment tail</code> and the <code>blank</code> in them.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/* The following 2 lines have the same output i.e. \`// DNA:RAW \` */</span>
<span class="token constant">SUPER</span><span class="token punctuation">(</span><span class="token number">1010100</span><span class="token punctuation">,</span> <span class="token string">&quot;ConstantEnumTemplate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VAR&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// DNA:RAW SUPER(1010100, &quot;ConstantEnumTemplate&quot;, &quot;VAR&quot;, &quot;VAR&quot;)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-8-dna-son-sub-template" tabindex="-1"><a class="header-anchor" href="#b3-8-dna-son-sub-template" aria-hidden="true">#</a> B3.8.DNA:SON Sub-Template</h2><p>Syntax: <code>DNA:SON</code> <code>blank</code>+ <code>path</code></p><p>Reads the resource in UTF8 from path and expands its contents at the current position, and then parse them all. The path can contain a protocol, classpath by default, only the following protocols are supported.</p><ul><li><code>http://</code>,<code>https://</code>, read by GET request</li><li><code>file://</code>,<code>/</code>, read from file system</li><li><code>classpath:</code>, read from the classloader, Note no <code>//</code> here</li><li>Starting with <code>/</code> or <code>.</code> means the relative path to the host template, but is not recommended.</li></ul><p>Note: the son templates must include <code>HI-MEEPO</code> separately, which is a static parsing in the separate context and later merged into the current parent template.</p><h2 id="b3-9-workshop-rna-dynamic-execution" tabindex="-1"><a class="header-anchor" href="#b3-9-workshop-rna-dynamic-execution" aria-hidden="true">#</a> B3.9.Workshop RNA, Dynamic Execution</h2><p>RNA is like a workshop manager, defining execution directives, calling the <code>execution engine</code> at merge time, and using its result as a replacement.</p><ul><li>An <code>execution engine</code> can execute <code>func</code> (function body) of multiple <code>types</code>, where one type is referred to as an <code>engine</code>.</li><li>The name of <code>engines</code> must be <code>alphanum</code>, case sensitive, e.g. <code>js</code>.</li><li>Engine whose name endwith <code>!</code> such as <code>js!</code>, will ignore errors ,continue execution, returns <code>null</code>.</li><li>If the execution returns <code>null</code>, <code>empty string</code> is used to merge the template.</li></ul><p>The default <code>engine</code> in RNA is <code>map</code>. Users can register other engines with RnaManager, described later.</p><ul><li><code>map</code> - <code>session</code> level, use <code>func</code> as key, go value from <code>environment</code>, if not, return the key.</li><li><code>raw</code> - <code>nothing</code> level, return the <code>func</code> directly as a string without expanding the escapes.</li></ul><p>Meepo uses multi-line block parsing for multi-line comments, so the <code>func</code> naturally supports multi-line to improve readability.</p><h2 id="b3-a-rna-put-put-variable" tabindex="-1"><a class="header-anchor" href="#b3-a-rna-put-put-variable" aria-hidden="true">#</a> B3.A.RNA:PUT Put Variable</h2><p>Syntax: <code>RNA:PUT</code> <code>blank</code>+ <code>engine</code>? <code>delim</code> <code>var</code> <code>delim</code> <code>func</code> <code>delim</code></p><p>Specify the <code>engine</code> to execute the <code>func</code> and store the <code>function</code> or <code>execution result</code> in the <code>environment</code> (referes map engine) for other <code>RNA</code> to use.</p><ul><li><code>environment</code> is the Meepo context and some scripting engine&#39;s context</li><li><code>engine</code> see engine description for details</li><li><code>delim</code> is the same as <code>SET</code>.</li><li><code>var</code> is the variable stored into the context, not the native literal.</li><li><code>func</code> is executed by a specific engine, such as spring, then it can be executed a SpEL.</li><li>if <code>var</code> or <code>func</code> is empty, nothing is executed.</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:PUT os/who/basename $(pwd)/</span>
<span class="token comment">/* Take the output of \`basename $(pwd)\` and store it in context with \`who\` as the key */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-b-rna-use-use-variable" tabindex="-1"><a class="header-anchor" href="#b3-b-rna-use-use-variable" aria-hidden="true">#</a> B3.B.RNA:USE Use Variable</h2><p>Syntax: <code>RNA:USE</code> <code>blank</code>+ <code>delim</code> <code>find</code> <code>delim</code> <code>var</code> <code>delim</code> <code>effect</code>?</p><p><code>RNA</code> version of <code>SET</code>, the difference is the <code>var</code> value is get from the <code>map</code> engine, not the literal replacement of the underlying template. The rules for getting variable(e.g., navigation class objects, pipeline handling functions) are described in the map engine section.</p><p>Automatic <code>multi-paragraph indentation</code> support is performed when merging <code>vars</code>, depending on the type of <code>var value</code> satisfying the follows,</p><ul><li><code>find string</code> starts with indented whitespace.</li><li><code>var value</code> is an Array or Collection and its size is greater than 1.</li></ul><p>Indenting more than 2 elements will align with the 1st element. sometimes lines may be unintelligent and look bad. eg.</p><ul><li>Indented object, no <code>\\n</code> ending, no line break, like zebra stripes</li><li>Unindented object, contains <code>\\n</code>, with line break, look interlaced</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:USE /meepo/user.home/</span>
<span class="token keyword">var</span> userHome <span class="token operator">=</span> <span class="token string">&quot;meepo&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* get System.getProperty(&quot;user.home&quot;). the output is:
var userHome = &quot;/home/trydofor&quot;;
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-c-rna-run-execute-every-time" tabindex="-1"><a class="header-anchor" href="#b3-c-rna-run-execute-every-time" aria-hidden="true">#</a> B3.C.RNA:RUN Execute Every Time</h2><p>Syntax: <code>RNA:RUN</code> <code>blank</code>+ <code>engine</code>? <code>delim</code> <code>find</code> <code>delim</code> <code>func</code> <code>delim</code> <code>effect</code>?</p><p>combine <code>PUT</code> and <code>USE</code>, support indentation, the difference are,</p><ul><li><code>find</code>, empty means execute only, no replace</li><li><code>func</code>, use execution result directly, no store to <code>var</code></li><li>execute every time, eg. counter function, increment on each call, no cache.</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// DNA:RUN os/rand/echo $RANDOM/1-3</span>
<span class="token keyword">var</span> userName <span class="token operator">=</span> <span class="token string">&quot;meepo-rand&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> userPass <span class="token operator">=</span> <span class="token string">&quot;rand-rand&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* get random number each time and print. the output is:
var userName = &quot;meepo-12599&quot;;
var userPass = &quot;16345-31415&quot;;
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-d-rna-when-conditional-execution" tabindex="-1"><a class="header-anchor" href="#b3-d-rna-when-conditional-execution" aria-hidden="true">#</a> B3.D.RNA:WHEN Conditional Execution</h2><p>Syntax: <code>RNA:WHEN</code> <code>blank</code>+ <code>engine</code>? <code>delim</code> <code>bool</code> <code>delim</code> <code>func</code> <code>delim</code> <code>group</code></p><p>Multiple <code>WHEN</code> can be combined into <code>if</code>-<code>else if</code>-<code>else</code> logic blocks.</p><ul><li><code>bool</code> - Must be <code>y|yes|n|no|not</code>, indicating <code>true</code> or <code>false</code></li><li><code>func</code> - Evaluate the execution result to bool</li><li><code>group</code> - Must be <code>alphanum</code>, group <code>ELSE</code> and <code>DONE</code> in the logic scope</li></ul><p>Evalue the following cases get <code>false</code>, evalue <code>not</code> to <code>false</code> get <code>true</code></p><ul><li>boolean <code>false</code></li><li>object <code>null</code></li><li>number <code>NaN</code> or between positive/negative <code>0.000000001</code> (9 digits)</li><li><code>empty</code> string, zero size of Array/Collection/Map</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!-- RNA:WHEN /yes/it.rem0/bg --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>rem0-name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- RNA:WHEN /not/it.rem1/bg --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>rem2-name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- RNA:ELSE bg --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>rem1-name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- RNA:DONE bg --&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Equivalent to the <code>if(a){}else if(!b){}else{}</code> in following js pseudocode</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>rem0<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;li value=&quot;code&quot;&gt;rem0-name&lt;/li&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>it<span class="token punctuation">.</span>rem1<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;li value=&quot;code&quot;&gt;rem2-name&lt;/li&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;li value=&quot;code&quot;&gt;rem1-name&lt;/li&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-e-rna-each-loop-execution" tabindex="-1"><a class="header-anchor" href="#b3-e-rna-each-loop-execution" aria-hidden="true">#</a> B3.E.RNA:EACH Loop Execution</h2><p>Syntax: <code>RNA:EACH</code> <code>blank</code>+ <code>engine</code>? <code>delim</code> <code>step</code> <code>delim</code> <code>func</code> <code>delim</code> <code>group</code></p><p>Using <code>group</code> to refer to the current element in the loop. if the <code>group</code> is named <code>it</code>, then <code>it.x</code> represents the <code>x</code> attribute of the element.</p><ul><li><code>step</code> - must be <code>-?[0-9]+</code>, the order and step, negative is <code>reverse</code> looping</li><li><code>func</code> - engine execution result, must be array/collection, otherwise equal to <code>RNA:PUT</code></li><li><code>group</code> - Must be <code>alphanum</code>, group <code>ELSE</code> and <code>DONE</code> in the logic scope, and refer to current element</li></ul><p>Depending on the data type, different loop processing is performed, null or empty is skipped and can be executed within <code>ELSE</code>.</p><ul><li>Array - Class.isArray()</li><li><code>Collection&lt;E&gt;</code> - instance of Collection</li><li>Other types, do not loop</li><li>Reverse-order loop, not (RandomAccess or ReverseIterator) are converted to toArray</li></ul><p>In the loop, the following built-in properties indicate the current status, given the <code>group</code> named <code>it</code>, then</p><ul><li><code>it</code> - The current element referenct, should avoid the name conflict to pollute the context</li><li>to reference the <code>x</code> attribute of the current element use<code>it.x</code></li><li><code>it._count</code> - Built-in variable, current loop counter, 1-base, 0 means not looped</li><li><code>it._total</code> - Built-in variable, total number of elements in the <code>group</code></li><li><code>it._first</code> - Built-in variable, whether the first element</li><li><code>it._last</code> - Built-in variable, whether the last element</li><li>These built-in variables are not removed at the end of the loop and can be used outside the loop.</li></ul><p>Since Meepo is a professional <code>non-professional</code> template engine, this <code>for-each</code> is very low-level,</p><ul><li>Limited support for object navigation, separated by <code>.</code>, see the <code>map</code> engine for details.</li><li>The element in the loop supports only <code>Map&lt;String,? &gt;</code> and JavaBean&#39;s Getter.</li><li>No scope isolation, the <code>group</code> name can override the variables within the context.</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!-- RNA:EACH map/2/items/it --&gt;</span>
<span class="token comment">&lt;!-- RNA:USE /name/it.name/* --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>rem0-name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- RNA:ELSE it --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>no item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- RNA:DONE it --&gt;</span>
<span class="token comment">&lt;!-- RNA:USE /total/it._total/ --&gt;</span>
<span class="token comment">&lt;!-- RNA:USE /count/it._count/ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>result=count/total<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Equivalent to the <code>for(;;)</code> or <code>for-in</code> loop logic of the following js pseudo-code, depending on the <code>collection</code> type and the <code>step</code> positive or negative.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> step<span class="token operator">=</span><span class="token number">2</span> <span class="token comment">// Loop steps, negative numbers in reverse order, must not 0</span>
<span class="token keyword">let</span> index<span class="token operator">=</span><span class="token number">0</span> <span class="token comment">// Temporary variables in the process</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> total<span class="token operator">=</span>items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// built-in variable</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>it <span class="token keyword">in</span> items<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">%</span> step <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span> <span class="token comment">// Control step</span>
    count<span class="token operator">++</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;li value=&quot;code&quot;&gt;rem0-&#39;</span><span class="token operator">+</span>it<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&#39;&lt;/li&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;li&gt;no item&lt;/li&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;div&gt;result=&#39;</span><span class="token operator">+</span>count<span class="token operator">+</span><span class="token string">&#39;/&#39;</span><span class="token operator">+</span>total<span class="token operator">+</span><span class="token string">&#39;&lt;/div&gt;&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="b3-f-rna-else-else-condition" tabindex="-1"><a class="header-anchor" href="#b3-f-rna-else-else-condition" aria-hidden="true">#</a> B3.F.RNA:ELSE Else Condition</h2><p>Syntax: <code>RNA:ELSE</code> <code>blank</code>+ <code>group</code></p><p>group by <code>group</code> and handle <code>else</code> branche on <code>WHEN</code> or <code>EACH</code> with the same group.</p><ul><li>If <code>WHEN</code>, it means none of the <code>WHEN</code> is executed</li><li>If <code>EACH</code>, it means the loop body is never executed (e.g. no elements)</li><li><code>EACH-ELSE</code> has the same semantics as <code>pebble</code>, is different from python&#39;s <code>for-else</code></li></ul><h2 id="b3-g-rna-done-stop-executing" tabindex="-1"><a class="header-anchor" href="#b3-g-rna-done-stop-executing" aria-hidden="true">#</a> B3.G.RNA:DONE Stop Executing</h2><p>Syntax: <code>RNA:DONE</code> (<code>blank</code>+ <code>group</code>)+</p><p>group by <code>group</code> to stop executing of one or more <code>WHEN</code> and <code>EACH</code> with the same group.</p><h2 id="b3-h-placeholder-template" tabindex="-1"><a class="header-anchor" href="#b3-h-placeholder-template" aria-hidden="true">#</a> B3.H.Placeholder Template</h2><p>Simplified template to perform only expression-level replacement or function handling, rather than the full Meepo template syntax. For example, placeholders in configuration files usually require simple replacement or string conversion.</p><p>To use it, just customize the <code>boundary</code> around the variable, <code>{{</code> and <code>}}</code> by default.</p><p>Define <code>escaping</code> char can escape the <code>boundary</code>, default is <code>empty</code>, no escaping. The escaping has the following characteristics, using <code>\\</code> for example,</p><ul><li>Available only for <code>boundar</code>, e.g. <code>\\{{</code> and <code>\\}}</code> to <code>{{</code> and <code>}}</code></li><li>Escape itself before the boundar, such as <code>\\\\{{var}}</code> to <code>\\</code> + <code>var</code> value</li><li>Placeholder, paired from left to right, use the closest pairs, non-matching boundary is treated as plain text.</li><li>Other cases are invalid, such as <code>\\n</code></li><li>Nested Placeholders is not supported</li><li>Variable names cannot contain spaces, or they will be resolved as a function</li></ul><h2 id="b3-i-limitation-of-using-rna" tabindex="-1"><a class="header-anchor" href="#b3-i-limitation-of-using-rna" aria-hidden="true">#</a> B3.I.Limitation of Using RNA</h2><p>Since the template generates a syntax tree during static parsing, the conditionals and loop execution in <code>RNA</code> do not recognize the runtime structure.</p><p>The following template intent is, to use the first truthy value between GitHash and ModTime by pattern <code>hash</code>. Intuitively, this format is more consistent with procedure-oriented conditional assignment, but causes a crossover scope error during syntax checking.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// HI-MEEPO
// RNA:WHEN /yes/GitHash/bg
//   RNA:USE /hash/GitHash/
// RNA:ELSE bg
//   RNA:USE /hash/ModTime/
// RNA:DONE bg
project hash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The crossover error occurs because the pattern <code>hash</code> has are two <code>RNA:USE</code> using it, In static parsing, the runtime value is not available, so it can not determine the correct the syntax tree to belong to, change it as follows</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// HI-MEEPO
// RNA:USE /hash/GitHash/
// RNA:USE /time/ModTime/

// RNA:WHEN /yes/GitHash/bg
project hash
// RNA:ELSE bg
project time
// RNA:DONE bg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or Use the <code>fun:see</code> function to help</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// HI-MEEPO
// RNA:USE /hash/fun:see GitHash ModTime/
project hash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,125),c=[s];function i(d,l){return n(),a("div",null,c)}const u=e(t,[["render",i],["__file","b3.syntax.html.vue"]]);export{u as default};
