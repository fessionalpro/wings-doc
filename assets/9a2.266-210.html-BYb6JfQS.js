import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,d as i,b as t,e as a,f as h,g as k,r as p,o as r}from"./app-CCOA2OJI.js";const d={};function g(A,s){const l=p("RouteLink");return r(),e("div",null,[s[8]||(s[8]=i("h1",{id:"_9a2-升迁2-6-6-210手册",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#_9a2-升迁2-6-6-210手册"},[i("span",null,"9A2.升迁2.6.6.210手册")])],-1)),s[9]||(s[9]=i("p",null,"build版从201升级210，有以下重点不兼容影响。",-1)),i("ul",null,[s[2]||(s[2]=i("li",null,"java以11取代8，其编译及启动参数变化",-1)),s[3]||(s[3]=i("li",null,"boot以2.6取代2.4，其webmvc，路径匹配有变",-1)),s[4]||(s[4]=i("li",null,"shardingsphere以5.1取代4.1，其结构更优",-1)),s[5]||(s[5]=i("li",null,[a("flywave以"),i("code",null,"__"),a("取代"),i("code",null,"$"),a("机制，以兼容云db功能")],-1)),s[6]||(s[6]=i("li",null,"swagger以springdoc取代springfox，以兼容boot2.6",-1)),s[7]||(s[7]=i("li",null,"fastjson2替换fastjson",-1)),i("li",null,[s[1]||(s[1]=a("检查")),h(l,{to:"/zh/9-example/9a.wings-change/9a0.notable.html"},{default:k(()=>s[0]||(s[0]=[a("wings notable changelog")])),_:1})])]),s[10]||(s[10]=t(`<h2 id="_9a2-1-修改pom-xml" tabindex="-1"><a class="header-anchor" href="#_9a2-1-修改pom-xml"><span>9A2.1.修改pom.xml</span></a></h2><p>210开始，所有artifactId并入<code>pro.fessional.wings</code>组内。 以下是parent和普通依赖的修改方法。</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 把【wings-project】变为【wings】--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- &lt;groupId&gt;pro.fessional&lt;/groupId&gt; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- &lt;artifactId&gt;wings-project&lt;/artifactId&gt; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pro.fessional&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;wings&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;2.6.6.210-SNAPSHOT&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 把【wings-】从artifactId 变为 groupId的【.wings】 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  &lt;!-- &lt;groupId&gt;pro.fessional&lt;/groupId&gt; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  &lt;!-- &lt;artifactId&gt;wings-silencer&lt;/artifactId&gt; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pro.fessional.wings&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;silencer&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;\${wings.version}&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-2-升迁到java11" tabindex="-1"><a class="header-anchor" href="#_9a2-2-升迁到java11"><span>9A2.2.升迁到java11</span></a></h2><p>当前使用的java11为<a href="https://jdk.java.net/archive/" target="_blank" rel="noopener noreferrer">openjdk build 11.0.2+9</a>， 推荐以<a href="https://asdf-vm.com" target="_blank" rel="noopener noreferrer">asdf</a>管理java8及java11环境，并在shell中设置<code>JDK8_HOME</code>和<code>JDK11_HOME</code>变量。</p><p>IDEA或maven启动java程序及TestCast时，需要相应的增加add-opens或add-exports参数</p><ul><li>maven-compiler-plugin - add-exports 编译</li><li>maven-surefire-plugin - add-opens 运行</li><li>IDEA运行TestCase - 自动获取surefire配置</li><li>IDEA运行Java和Boot - 手工设置启动参数模板，</li></ul><p>其中启动参数为<code>\${wings.java-opens}</code>内容，不推荐全局变量，如JAVA_TOOL_OPTIONS。 IDEA中需要在<code>Run/Debug Configuration Templates</code>中分别设置<code>Application</code>和<code>Spring Boot</code></p><p>参考资料</p><ul><li><a href="https://stackoverflow.com/questions/44056405" target="_blank" rel="noopener noreferrer">What&#39;s the difference between --add-exports and --add-opens ...</a></li><li><a href="https://stackoverflow.com/questions/70196098" target="_blank" rel="noopener noreferrer">How can I specify --add-opens from a project level ...</a></li></ul><h2 id="_9a2-3-日志表命名" tabindex="-1"><a class="header-anchor" href="#_9a2-3-日志表命名"><span>9A2.3.日志表命名</span></a></h2><p>主要是log表，从dollar变为double underscore风格，trigger后缀变为前缀。</p><ul><li>log表从<code>table$log</code> 变为<code>table__</code></li><li>trigger从<code>table$ai</code> 变为<code>ai__table</code></li></ul><p>操作步骤如下，</p><ul><li>执行 JournalManager.manageTriggers(table, true) 删除旧trigger</li><li>执行 JournalManager.checkAndInitDdl(table, cid) 以新配置替换旧配置</li><li>手工rename journal table</li><li>执行 JournalManager.publishInsert/Update/Delete(table,true, cid) 生成新trigger</li></ul><p>如果数据为mysql8，且符合wings规范，可以采用以下sql测试。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  TABLE_NAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TRACE_TBL,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  REPLACE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(TABLE_NAME,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$log&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PLAIN_TBL,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ALTER TABLE &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,table_name,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; RENAME TO &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">REPLACE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(table_name, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$log&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;__&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;;;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> RENAME_DDL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">TABLES</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name REGEXP </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\\\\$log&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  TRIGGER_NAME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> OLD_NAME,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  REGEXP_REPLACE(TRIGGER_NAME,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;^(.+)\\\\$(.+)$&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$2__$1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NEW_NAME,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  CONCAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DROP TRIGGER IF EXISTS &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,TRIGGER_NAME,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;;;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> DROP_DDL,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  REPLACE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">CONCAT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;CREATE TRIGGER \`&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, REGEXP_REPLACE(TRIGGER_NAME,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;^(.+)\\\\$(.+)$&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$2__$1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\` &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ACTION_TIMING, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, EVENT_MANIPULATION, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; ON \`&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, EVENT_OBJECT_TABLE, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;\` FOR EACH ROW &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ACTION_STATEMENT, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;;;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;$log&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;__&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CREATE_DDL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  INFORMATION_SCHEMA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">TRIGGERS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  EVENT_OBJECT_SCHEMA </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">DELIMITER ;;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 复制以上 DROP_DDL, RENAME_DDL, CREATE_DDL，依次执行即可。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-4-lombok移除var" tabindex="-1"><a class="header-anchor" href="#_9a2-4-lombok移除var"><span>9A2.4.lombok移除var</span></a></h2><p>import lombok.var;</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;*.java&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> read</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/import lombok.var;//g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-5-swagger3-0注解" tabindex="-1"><a class="header-anchor" href="#_9a2-5-swagger3-0注解"><span>9A2.5.Swagger3.0注解</span></a></h2><p>springdoc全面使用OpenApi/Swagger3.0，因此springfox的Swagger2.0注解需要替换 具体细节参考 <a href="https://springdoc.org/#migrating-from-springfox" target="_blank" rel="noopener noreferrer">https://springdoc.org/#migrating-from-springfox</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 swagger2的注解</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;*.java&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> read</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;import io.swagger.annotations&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/tmp/swagger.log</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sort</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/swagger.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">uniq</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/swagger.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 替换常用标签，自行修改格式偏差引发的编译错误</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;*.java&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> read</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/import io.swagger.annotations.ApiModel;/import io.swagger.v3.oas.annotations.media.Schema;/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/import io.swagger.annotations.ApiModelProperty;/import io.swagger.v3.oas.annotations.media.Schema;/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/import io.swagger.annotations.Api;/import io.swagger.v3.oas.annotations.tags.Tag;/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/import io.swagger.annotations.ApiOperation;/import io.swagger.v3.oas.annotations.Operation;/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/@ApiModel\\((.*)\\)/@Schema(description = \\1)/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/@ApiModelProperty\\((.*)\\)/@Schema(description = \\1)/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/@Api\\((.*)\\)/@Tag(name = \\1)/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/@ApiOperation\\((.*)\\)/@Operation(summary = \\1)/g&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $fl</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-6-升级mysql8-0" tabindex="-1"><a class="header-anchor" href="#_9a2-6-升级mysql8-0"><span>9A2.6.升级mysql8.0</span></a></h2><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/upgrade-binary-package.html" target="_blank" rel="noopener noreferrer">先全备再恢复 Logical Upgrade</a></li><li><a href="https://dev.mysql.com/blog-archive/inplace-upgrade-from-mysql-5-7-to-mysql-8-0" target="_blank" rel="noopener noreferrer">原地data升级 In-Place Upgrade</a></li><li><a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-utilities-upgrade.html" target="_blank" rel="noopener noreferrer">检查工具 mysql shell</a></li></ul><p>wings工程使用jooq，避免复杂sql，仅为sql基本功能，一般无兼容性。可使用mysql shell检查</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方法一，需要安装 mysql shell</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqlsh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> util</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checkForServerUpgrade</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root@wings-sql-dev5:3306</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --target-version=8.0.26</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --output-format=JSON</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方法二，使用mysql-client 8.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqlcheck</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --protocol=tcp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kite-sql-dev5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all-databases</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --check-upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原地（In-Place）升级，即使用5.7的原data目录，直接启动mysql8，对其数据结构自动调整。 简单数据库（单机，单容器）推荐使用，如使用docker启动mysql8.0，检查以下2项，即可自动升级。</p><ul><li>其data指向mysql5.7的data。</li><li>mysqld中配置upgrade=FORCE</li></ul><p>逻辑（logical）升级，指先dump后restore，复杂数据库（云，主从，集群）推荐使用。 直接恢复5.7的FullDump到8.0，需要设置<code>upgrade=FORCE</code>参数的权限，以完全最后升级， 否则会出现用户能够登录，但Access denied问题，使支撑类用户和功能不好用。</p><p>因此建议在有mysql8 client的机器上，分别dump业务用户和业务库，然后restore。</p><ul><li>dump mysql5.7 业务用户，业务库</li><li>restore mysql 8.0 先用户再库</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 生成配置文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kite-sql.cnf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[client]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">protocol=tcp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">port=3306</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">user=trydofor</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">password=moilioncircle</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用 mysqlpump，以支持更多的选项，全部使用mysql8的client</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqlpump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --defaults-extra-file=kite-sql.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kite-sql-dev5</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--all-databases </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--exclude-databases=information_schema,mysql,performance_schema,sys</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--set-gtid-purged=OFF &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysql-5.7-data.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqlpump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --defaults-extra-file=kite-sql.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kite-sql-dev5</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--users </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--exclude-users=root,%backup</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--exclude-databases=% </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--set-gtid-purged=OFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysql-5.7-user.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;flush privileges;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysql-5.7-user.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果dump是没有忽略innodb_*_status，需要使用--force跳过错误</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mysql-5.7-user.sql</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mysql-5.7-data.sql</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --defaults-extra-file=kite-sql.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kite-sql-dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-7-破坏性影响" tabindex="-1"><a class="header-anchor" href="#_9a2-7-破坏性影响"><span>9A2.7.破坏性影响</span></a></h2><ul><li>wings-project不在依赖devtools，估以此为parent的项目需要自行dependency。</li><li>warlock security的url权限配置，从List变为Map，明确了由宽松到严谨的覆盖关系。</li><li>mirana重写DateLocaling方法名，编译错误时，可依靠参数列表，批量替换方法名。</li><li>Warlock1SchemaManager 重命名方法</li><li>@JsonI18nString变为@AutoI18nString</li></ul><h2 id="_9a2-8-jooqdao不兼容" tabindex="-1"><a class="header-anchor" href="#_9a2-8-jooqdao不兼容"><span>9A2.8.JooqDao不兼容</span></a></h2><p>原静态引用的方式不建议使用了。</p><ul><li>val t = dao.getTable()</li><li>val a = dao.getAlias()</li></ul><p>推荐以dao.getTable及getAlias定义局部变量取代静态全局表 原fetch(Condition)签名，可变为以下形式</p><ul><li>fetch(Table, Condition)</li><li>fetch(t -&gt; Fn.of(t.Id.eq(1L)))</li></ul><h2 id="_9a2-9-外部api兼容性" tabindex="-1"><a class="header-anchor" href="#_9a2-9-外部api兼容性"><span>9A2.9.外部Api兼容性</span></a></h2><ul><li><p>mysql8没有password函数，采用以下组合替换。 SELECT CONCAT(&#39;*&#39;, UPPER(SHA1(UNHEX(SHA1(&#39;trydofor&#39;))))), password(&#39;trydofor&#39;);</p></li><li><p>java11中DateTimeFormatter的调整，如 Offset X原来的<code>XXX</code>不能代表<code>XXXX</code>和<code>XXXXX</code>，以此类推。</p></li><li><p>fastjson2，应该直接以<code>com.alibaba.fastjson2.</code>替换<code>com.alibaba.fastjson.</code>即可。 若对fastjson依赖过于重和复杂，请务必审查工程质量，确认用法安全。</p></li></ul><h2 id="_9a2-a-authn拼写错误" tabindex="-1"><a class="header-anchor" href="#_9a2-a-authn拼写错误"><span>9A2.A.Authn拼写错误</span></a></h2><p>通过Flywave执行<code>2021-09-18v01</code>，修复<code>win_user_authn</code>拼写错误</p><h3 id="a1-执行sql脚本" tabindex="-1"><a class="header-anchor" href="#a1-执行sql脚本"><span>a1.执行sql脚本</span></a></h3><p>在未分表且无跟踪表时，可手动执行升级sql。 否则建议使用flywave执行，避免遗漏。</p><ul><li>rename win_user_authn</li><li>update sys_light_sequence</li><li>update shard table_#</li><li>update trace table$log</li><li>update triggers</li></ul><h3 id="a2-替换java文件" tabindex="-1"><a class="header-anchor" href="#a2-替换java文件"><span>a2.替换java文件</span></a></h3><p>全工程的java文件，替换以下字符串</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/user_authn/user_authn/g&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/UserAuthn/UserAuthn/g&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-b-拆分warlockbond工程" tabindex="-1"><a class="header-anchor" href="#_9a2-b-拆分warlockbond工程"><span>9A2.B.拆分WarlockBond工程</span></a></h2><p>用户权限的默认数据库实现，拆分为warlock-bond工程，</p><ul><li>不需要此实现的，dependency warlock，</li><li>否则，dependency warlock-bond</li></ul><p>同时增加<code>2020-10-23v01</code>，以消除flywave-fit警报。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT IGNORE INTO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`sys_schema_version\`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`revision\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`commit_id\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`apply_dt\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`comments\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`upto_sql\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`undo_sql\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2020102302</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOW</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-c-拆分codegen工程" tabindex="-1"><a class="header-anchor" href="#_9a2-c-拆分codegen工程"><span>9A2.C.拆分CodeGen工程</span></a></h2><p>代码生成工具，分离为独立工程，分别为faceless-codegen和warlock-codegen， 实际使用中，直接依赖warlock-codegen即可，示例maven配置如下</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pro.fessional.wings&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;warlock-codegen&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;test&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a2-d-多国语功能调整" tabindex="-1"><a class="header-anchor" href="#_9a2-d-多国语功能调整"><span>9A2.D.多国语功能调整</span></a></h2><p><code>sys_standard_i18n</code>中<code>ukey</code>语义为，约束唯一数据或enum类定位成员</p><ul><li><code>id</code>类型 - <code>id.</code> + id</li><li><code>code</code>类型 - type + <code>.</code> + code</li><li>java的enum，则由包名，类名，name构成</li></ul><p>修改内容包括，数据记录和codegen代码的多国语功能，</p><ul><li>替换数据，如 2019-05-21v01-enum-i18n.sql</li><li>重新生成模板代码，如 StandardLanguage</li></ul><h2 id="_9a2-e-配置属性的变更" tabindex="-1"><a class="header-anchor" href="#_9a2-e-配置属性的变更"><span>9A2.E.配置属性的变更</span></a></h2><h3 id="e1-wings-monitor-79-properties" tabindex="-1"><a class="header-anchor" href="#e1-wings-monitor-79-properties"><span>e1.wings-monitor-79.properties</span></a></h3><ul><li><code>report-keyword</code> 变为 <code>notice-keyword</code></li></ul>`,66))])}const y=n(d,[["render",g],["__file","9a2.266-210.html.vue"]]),B=JSON.parse('{"path":"/zh/9-example/9a.wings-change/9a2.266-210.html","title":"9A2.升迁2.6.6.210手册","lang":"zh-CN","frontmatter":{"isOriginal":true,"icon":"circle-up","category":["实战","升迁"],"description":"9A2.升迁2.6.6.210手册 build版从201升级210，有以下重点不兼容影响。 java以11取代8，其编译及启动参数变化 boot以2.6取代2.4，其webmvc，路径匹配有变 shardingsphere以5.1取代4.1，其结构更优 flywave以__取代$机制，以兼容云db功能 swagger以springdoc取代spring...","GIT_REPO_HEAD":"2025-02-06 a8fb043a36c51604d1078076241b71fc4a4529a1","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://wings.fessional.pro/9-example/9a.wings-change/9a2.266-210.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/zh/9-example/9a.wings-change/9a2.266-210.html"}],["meta",{"property":"og:site_name","content":"WingsBoot 纹丝不忒"}],["meta",{"property":"og:title","content":"9A2.升迁2.6.6.210手册"}],["meta",{"property":"og:description","content":"9A2.升迁2.6.6.210手册 build版从201升级210，有以下重点不兼容影响。 java以11取代8，其编译及启动参数变化 boot以2.6取代2.4，其webmvc，路径匹配有变 shardingsphere以5.1取代4.1，其结构更优 flywave以__取代$机制，以兼容云db功能 swagger以springdoc取代spring..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-01-09T11:57:11.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-09T11:57:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"9A2.升迁2.6.6.210手册\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-09T11:57:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"9A2.1.修改pom.xml","slug":"_9a2-1-修改pom-xml","link":"#_9a2-1-修改pom-xml","children":[]},{"level":2,"title":"9A2.2.升迁到java11","slug":"_9a2-2-升迁到java11","link":"#_9a2-2-升迁到java11","children":[]},{"level":2,"title":"9A2.3.日志表命名","slug":"_9a2-3-日志表命名","link":"#_9a2-3-日志表命名","children":[]},{"level":2,"title":"9A2.4.lombok移除var","slug":"_9a2-4-lombok移除var","link":"#_9a2-4-lombok移除var","children":[]},{"level":2,"title":"9A2.5.Swagger3.0注解","slug":"_9a2-5-swagger3-0注解","link":"#_9a2-5-swagger3-0注解","children":[]},{"level":2,"title":"9A2.6.升级mysql8.0","slug":"_9a2-6-升级mysql8-0","link":"#_9a2-6-升级mysql8-0","children":[]},{"level":2,"title":"9A2.7.破坏性影响","slug":"_9a2-7-破坏性影响","link":"#_9a2-7-破坏性影响","children":[]},{"level":2,"title":"9A2.8.JooqDao不兼容","slug":"_9a2-8-jooqdao不兼容","link":"#_9a2-8-jooqdao不兼容","children":[]},{"level":2,"title":"9A2.9.外部Api兼容性","slug":"_9a2-9-外部api兼容性","link":"#_9a2-9-外部api兼容性","children":[]},{"level":2,"title":"9A2.A.Authn拼写错误","slug":"_9a2-a-authn拼写错误","link":"#_9a2-a-authn拼写错误","children":[{"level":3,"title":"a1.执行sql脚本","slug":"a1-执行sql脚本","link":"#a1-执行sql脚本","children":[]},{"level":3,"title":"a2.替换java文件","slug":"a2-替换java文件","link":"#a2-替换java文件","children":[]}]},{"level":2,"title":"9A2.B.拆分WarlockBond工程","slug":"_9a2-b-拆分warlockbond工程","link":"#_9a2-b-拆分warlockbond工程","children":[]},{"level":2,"title":"9A2.C.拆分CodeGen工程","slug":"_9a2-c-拆分codegen工程","link":"#_9a2-c-拆分codegen工程","children":[]},{"level":2,"title":"9A2.D.多国语功能调整","slug":"_9a2-d-多国语功能调整","link":"#_9a2-d-多国语功能调整","children":[]},{"level":2,"title":"9A2.E.配置属性的变更","slug":"_9a2-e-配置属性的变更","link":"#_9a2-e-配置属性的变更","children":[{"level":3,"title":"e1.wings-monitor-79.properties","slug":"e1-wings-monitor-79-properties","link":"#e1-wings-monitor-79-properties","children":[]}]}],"git":{"createdTime":1656137116000,"updatedTime":1736423831000,"contributors":[{"name":"trydofor","username":"trydofor","email":"trydofor@gmail.com","commits":19,"url":"https://github.com/trydofor"}]},"readingTime":{"minutes":5.97,"words":1791},"filePathRelative":"zh/9-example/9a.wings-change/9a2.266-210.md","localizedDate":"2022年6月25日","autoDesc":true}');export{y as comp,B as data};
