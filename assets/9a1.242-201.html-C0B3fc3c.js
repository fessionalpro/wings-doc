import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o,c as l,b as a,e as n,d as p,w as i,f as r}from"./app-D2c23tTX.js";const c={},d=a("h1",{id:"_9a1-upgrade-2-4-2-201",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_9a1-upgrade-2-4-2-201"},[a("span",null,"9A1.Upgrade 2.4.2.201")])],-1),u=a("p",null,"Upgraded build 200 to 201, closer to flywave's engineering practices, with the following major incompatibility,",-1),g=a("li",null,"Adjusted pom.xml structure, former wings-home renamed to wings-project",-1),m=a("li",null,"flywave journal management using the new trigger form",-1),k=a("li",null,"flywave default confirm all, no interaction, need to set askYes manually",-1),h=r(`<h2 id="_9a1-1-maven-setting" tabindex="-1"><a class="header-anchor" href="#_9a1-1-maven-setting"><span>9A1.1.Maven Setting</span></a></h2><p>Change POM&#39;s parent from <code>wings-home:2.4.2.200-SNAPSHOT</code> to <code>wings-project:2.4.2.201-SNAPSHOT</code></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pro.fessional<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>wings-project<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2.201-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-2-table-restruct" tabindex="-1"><a class="header-anchor" href="#_9a1-2-table-restruct"><span>9A1.2.Table Restruct</span></a></h2><p>Execute the operations in the following order</p><ul><li>Execute 2021-12-20v01-journal-trg-insert.sql to add new journal structure</li><li>Execute JournalManager.manageTriggers(table, true) to delete the old trigger</li><li>Execute JournalManager.checkAndInitDdl(table, cid) to replace the old config to new</li><li>Execute JournalManager.publishInsert/Update/Delete(table, true, cid) to generate a new trigger</li></ul><p>If you need to import the data from the original trace table into the new one, and you want to keep the old data and the new data in the same <code>_id</code> incremental order. then you need to set AUTO_INCREMENT manually so that it is greater than the total number of data in the old table. And manually update the inserted data <code>_id</code> during the operation.</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token keyword">table</span>$log <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> $count<span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> <span class="token keyword">table</span>$log <span class="token keyword">set</span> _id <span class="token operator">=</span> $count <span class="token operator">+</span> _id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>If you do not care about the order, or have set AUTO_INCREMENT to start, execute the following SQL to import the data,</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token variable">@tabl</span> <span class="token operator">=</span> <span class="token string">&#39;win_user_basis&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@cols</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">&#39;\`&#39;</span><span class="token punctuation">,</span> GROUP_CONCAT<span class="token punctuation">(</span>COLUMN_NAME SEPARATOR <span class="token string">&#39;\`, \`&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;\`&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
    <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">AND</span> TABLE_NAME <span class="token operator">=</span> <span class="token variable">@tabl</span>
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ORDINAL_POSITION
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@restoreSql</span> <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span>
        <span class="token string">&#39;INSERT INTO &#39;</span><span class="token punctuation">,</span> <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$log&#39;</span>
            <span class="token string">&#39; SELECT NULL, _dt, _tp, &#39;</span><span class="token punctuation">,</span> <span class="token variable">@cols</span><span class="token punctuation">,</span><span class="token string">&#39; FROM ((SELECT *,\\&#39;U\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$upd) UNION (SELECT *,\\&#39;D\\&#39; as _tp FROM &#39;</span><span class="token punctuation">,</span>
        <span class="token variable">@tabl</span><span class="token punctuation">,</span> <span class="token string">&#39;$del)) as old ORDER BY _dt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>

<span class="token keyword">PREPARE</span> stmt <span class="token keyword">FROM</span> <span class="token variable">@restoreSql</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> stmt<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9a1-3-compile-error" tabindex="-1"><a class="header-anchor" href="#_9a1-3-compile-error"><span>9A1.3.Compile Error</span></a></h2><p>Set the method of InteractiveManager according to the compile prompt. If your ever use flywave to manage datas and tables in automatic environment (batch, web), you need to define your own InteractiveManager.askWay implementation. Default implementations are,</p><ul><li>FlywaveInteractiveTty based on console</li><li>FlywaveInteractiveGui based on Swing dialog</li></ul><p>If HeadlessException is thrown at startup, it is possible that AWT Font, Color, etc. are used before wings.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span>GraphicsEnvironment</span><span class="token punctuation">.</span><span class="token function">checkHeadless</span><span class="token punctuation">(</span><span class="token class-name">GraphicsEnvironment</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Needs set in the code <code>System.setProperty(&quot;java.awt.headless&quot;, &quot;false&quot;);</code> closest to or before the main method, Or set <code>-Djava.awt.headless=false</code> to jvm parameters.</p><h2 id="_9a1-4-datasource-change" tabindex="-1"><a class="header-anchor" href="#_9a1-4-datasource-change"><span>9A1.4.DataSource Change</span></a></h2><p>For the data sharding or R/W separation scenario, split the faceless shard project, so that the DataSource uses the Spring format by default.</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment"># Replace with spring default data source</span>
spring.datasource.url
spring.datasource.username
spring.datasource.password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19);function v(b,w){const s=t("RouteLink");return o(),l("div",null,[d,u,a("ul",null,[g,m,k,a("li",null,[n("check "),p(s,{to:"/9-example/9a.wings-change/9a0.notable.html"},{default:i(()=>[n("wings notable changelog")]),_:1})])]),h])}const y=e(c,[["render",v],["__file","9a1.242-201.html.vue"]]),E=JSON.parse(`{"path":"/9-example/9a.wings-change/9a1.242-201.html","title":"9A1.Upgrade 2.4.2.201","lang":"en-US","frontmatter":{"isOriginal":true,"icon":"change","category":["Practice","Upgrade"],"description":"9A1.Upgrade 2.4.2.201 Upgraded build 200 to 201, closer to flywave's engineering practices, with the following major incompatibility, Adjusted pom.xml structure, former wings-ho...","GIT_REPO_HEAD":"2024-06-10 b1ec3d73a48e6ec52c12b931d1822da253f48375","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://wings.fessional.pro/zh/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/9-example/9a.wings-change/9a1.242-201.html"}],["meta",{"property":"og:site_name","content":"WingsBoot Win Sprint"}],["meta",{"property":"og:title","content":"9A1.Upgrade 2.4.2.201"}],["meta",{"property":"og:description","content":"9A1.Upgrade 2.4.2.201 Upgraded build 200 to 201, closer to flywave's engineering practices, with the following major incompatibility, Adjusted pom.xml structure, former wings-ho..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-06-18T08:37:26.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2023-06-18T08:37:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"9A1.Upgrade 2.4.2.201\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-06-18T08:37:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"9A1.1.Maven Setting","slug":"_9a1-1-maven-setting","link":"#_9a1-1-maven-setting","children":[]},{"level":2,"title":"9A1.2.Table Restruct","slug":"_9a1-2-table-restruct","link":"#_9a1-2-table-restruct","children":[]},{"level":2,"title":"9A1.3.Compile Error","slug":"_9a1-3-compile-error","link":"#_9a1-3-compile-error","children":[]},{"level":2,"title":"9A1.4.DataSource Change","slug":"_9a1-4-datasource-change","link":"#_9a1-4-datasource-change","children":[]}],"git":{"createdTime":1680228107000,"updatedTime":1687077446000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":3}]},"readingTime":{"minutes":1.44,"words":432},"filePathRelative":"9-example/9a.wings-change/9a1.242-201.md","localizedDate":"March 31, 2023","autoDesc":true}`);export{y as comp,E as data};
