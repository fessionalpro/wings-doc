import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as e,e as a}from"./app-DEdToB0k.js";const t={},n=a(`<h1 id="_4b-combined-authz" tabindex="-1"><a class="header-anchor" href="#_4b-combined-authz"><span>4B.Combined Authz</span></a></h1><p>Authorization is a combination of permissions (Perm) and roles (Role). Both are defined in db and auto generated into java classes through templates.</p><ul><li>Function permission - role inheritance and extension, id sudo, temp add/drop, superuser</li><li>Data isolation - scope isolation, function inheritance, assistant extension, temp authz</li></ul><h2 id="_4b-1-perm-ission" tabindex="-1"><a class="header-anchor" href="#_4b-1-perm-ission"><span>4B.1 Perm(ission)</span></a></h2><p><code>Perm</code> consists of scope and action, both are <code>.</code> separated and <code>all lowercase</code> naming rule, see java variable naming.</p><p>The format is <code>scope + (&#39;.&#39; + scope )* + &#39;.&#39; + action</code>, i.e. multiple level scopes, and the last is action</p><ul><li>scope is a noun that supports affiliation, using <code>.</code> separates, <code>system.menu</code> belongs to <code>system</code></li><li>the first scope cannot be ROLE prefix (spring default is ROLE_)</li><li>action is a verb that supports scope affiliation, e.g. <code>system.menu.read</code> belongs to <code>system.read</code></li><li><code>*</code> means that it contains all actions, and is only used to configure the affiliation relationship, and cannot be used on specific methods</li></ul><p><code>Perm</code> is mainly used for method-level authentication, i.e. annotations added to methods, such as <code>@Secured</code>, <code>@Pre*</code>.</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// https://docs.spring.io/spring-security/reference/servlet/authorization/method-security.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// recommended, invoke hasAnyAuthority via SecuredAuthorizationManager</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Secured</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">PermConstant</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">read</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// JSR250 only work for role</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RolesAllowed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PermitAll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">DenyAll</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Not recommended because it&#39;s longer, and SpEL is too powerful</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PreAuthorize</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(hasAuthority </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> PermConstant</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Perm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> End)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PreAuthorize</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hasAuthority(&#39;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> PermConstant</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Perm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&#39;)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PreAuthorize</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hasAnyAuthority(T(pro.fessional.wings.warlock.security.autogen.PermConstant$System$User).read)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4b-2-role" tabindex="-1"><a class="header-anchor" href="#_4b-2-role"><span>4B.2.Role</span></a></h2><p><code>Role</code> does not support inheritance, it is <code>all-caps</code> unseparated naming rule (to distinguish permissions), see java variable naming.</p><ul><li>The <code>ROLE_</code> prefix as spring is used in the auto generated java code.</li><li>Role is flat, but can be configured for affiliation, e.g. LEADER includes MEMBER</li><li>No separator, meaning words separated by <code>_</code> are treated as one word.</li><li>Prefix is not recommended in db, the default prefix is added automatically on load (Spring default is ROLE_)</li></ul><p><code>Role</code> is mainly used in filter-level configuration, such as url permissions. Of course, it can also be used at method level. When used in configuration, you need to add the prefix, and it is recommended to use the prefix to distinguish Perm.</p><h2 id="_4b-3-working-mechanism" tabindex="-1"><a class="header-anchor" href="#_4b-3-working-mechanism"><span>4B.3.Working Mechanism</span></a></h2><p>Warlock loads the Perm and Role associated with the user after the user has passed the authn (renew), and flattens their affiliation and inheritance relationships, and loads them all into the SecurityContext.</p><p>When the string of <code>Perm</code> and <code>Role</code> (with prefix) starts with <code>-</code>, it means that this permission is excluded and has the highest priority.</p><p>You can configure <code>mem-auth</code> and then change the user&#39;s permissions for different login methods. For example, implementing ComboWarlockAuthzService.Combo also allows you to change permissions by condition.</p><h2 id="_4b-4-data-permission" tabindex="-1"><a class="header-anchor" href="#_4b-4-data-permission"><span>4B.4.Data Permission</span></a></h2><p>Data permissions, including user, department, and company, are visible at three levels.</p><ul><li>User (User), based on user_id, also includes sub-accounts</li><li>Department (Dept), based on dept_id, including departments relationship</li><li>Corp (Corp), based on corp_id, usually related to domain</li><li>Tenant (Saas), based on saas_id, usually in SaaS system</li></ul>`,20),l=[n];function o(r,h){return e(),s("div",null,l)}const c=i(t,[["render",o],["__file","4b-authz.html.vue"]]),k=JSON.parse('{"path":"/4-warlock/4b-authz.html","title":"4B.Combined Authz","lang":"en-US","frontmatter":{"isOriginal":true,"icon":"key","category":["Warlock","Authz"],"description":"4B.Combined Authz Authorization is a combination of permissions (Perm) and roles (Role). Both are defined in db and auto generated into java classes through templates. Function ...","GIT_REPO_HEAD":"2025-01-17 e638e7035dc7958e3f145793e37c871eb02f12d5","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://wings.fessional.pro/zh/4-warlock/4b-authz.html"}],["meta",{"property":"og:url","content":"https://wings.fessional.pro/4-warlock/4b-authz.html"}],["meta",{"property":"og:site_name","content":"WingsBoot Win Sprint"}],["meta",{"property":"og:title","content":"4B.Combined Authz"}],["meta",{"property":"og:description","content":"4B.Combined Authz Authorization is a combination of permissions (Perm) and roles (Role). Both are defined in db and auto generated into java classes through templates. Function ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-12T00:21:52.000Z"}],["meta",{"property":"article:author","content":"trydofor"}],["meta",{"property":"article:modified_time","content":"2024-06-12T00:21:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"4B.Combined Authz\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-12T00:21:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"trydofor\\",\\"url\\":\\"https://www.trydofor.com\\"}]}"]]},"headers":[{"level":2,"title":"4B.1 Perm(ission)","slug":"_4b-1-perm-ission","link":"#_4b-1-perm-ission","children":[]},{"level":2,"title":"4B.2.Role","slug":"_4b-2-role","link":"#_4b-2-role","children":[]},{"level":2,"title":"4B.3.Working Mechanism","slug":"_4b-3-working-mechanism","link":"#_4b-3-working-mechanism","children":[]},{"level":2,"title":"4B.4.Data Permission","slug":"_4b-4-data-permission","link":"#_4b-4-data-permission","children":[]}],"git":{"createdTime":1656137116000,"updatedTime":1718151712000,"contributors":[{"name":"trydofor","email":"trydofor@gmail.com","commits":5}]},"readingTime":{"minutes":1.58,"words":473},"filePathRelative":"4-warlock/4b-authz.md","localizedDate":"June 25, 2022","autoDesc":true}');export{c as comp,k as data};
