import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as c,c as l,b as e,e as s,d as a,f as o}from"./app-7d38ae22.js";const p={},r=o(`<h1 id="_2h-æ—¶é—´å’Œæ—¶åŒº" tabindex="-1"><a class="header-anchor" href="#_2h-æ—¶é—´å’Œæ—¶åŒº" aria-hidden="true">#</a> 2H.æ—¶é—´å’Œæ—¶åŒº</h1><p>æ•°æ®åº“æœ‰å…³çš„æ—¶é—´ï¼Œæ—¶åŒºï¼Œé›¶å€¼çº¦å®šã€‚</p><p>æ˜¯<code>TimeZone</code>è¿˜æ˜¯<code>timezone</code>ï¼Œæ˜¯å¤§<code>Z</code>è¿˜æ˜¯å°<code>z</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ ğŸ˜ƒ</p><p>é¦–å…ˆï¼Œjavaä¸­<code>TimeZone</code>å’Œ<code>ZoneId</code>éƒ½æ˜¯ä¸­é—´å¤§å†™çš„ï¼Œä¸¤ä¸ªè¯çš„ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†å‘½åè½¬æ¢ä¸­ä¸å‡ºç°<code>time_zone</code>æˆ–<code>time-zone</code>ï¼Œ Wingsåœ¨é…ç½®å’Œæ•°æ®å±‚ï¼Œå…¨åšä¸€è¯å¤„ç†ï¼Œå³<code>timezone</code>å’Œ<code>Zoneid</code>ã€‚</p><p>åŒæ ·çš„å¤„ç†æ–¹å¼ï¼Œæœ‰æ—¶ä¹Ÿå‡ºç°åœ¨<code>DateTime</code>ä¸Šã€‚</p><h2 id="_2h-1-æ—¥æ—¶é›¶å€¼å’Œæ—¶åŒº" tabindex="-1"><a class="header-anchor" href="#_2h-1-æ—¥æ—¶é›¶å€¼å’Œæ—¶åŒº" aria-hidden="true">#</a> 2H.1.æ—¥æ—¶é›¶å€¼å’Œæ—¶åŒº</h2><p>æ‰§è¡Œç¯å¢ƒå’Œæ•°æ®åº“è¦åœ¨åŒä¸€æ—¶åŒºï¼Œå¦åˆ™jooqå’Œjdbcåœ¨ä»¥ä¸‹è¿‡ç¨‹ä¼šè‡ªåŠ¨è½¬æ¢æ—¶åŒºï¼Œå¼•å‘é—®é¢˜ã€‚</p><p>å¦‚æœæœåŠ¡å™¨å’Œæ‰§è¡Œç¯å¢ƒæ—¶åŒºä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åè°ƒã€‚</p><ul><li>é€šè¿‡wingsçš„å‚æ•°è®¾ç½®æ—¶åŒº <code>wings.silencer.i18n.zoneid=Asia/Shanghai</code></li><li>javaçš„å¯åŠ¨å‚æ•° <code>-Duser.timezone=Asia/Shanghai</code></li><li>mysqlçš„jdbcçš„urlå‚æ•° <code>connectionTimeZone=%2B08:00&amp;forceConnectionTimeZoneToSession=true</code></li><li>javaçš„ä»£ç å‚æ•° <code>TimeZone.setDefault(TimeZone.getTimeZone(&quot;Asia/Shanghai&quot;));</code></li></ul><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">wings.silencer.i18n.zoneid</span><span class="token punctuation">=</span><span class="token value attr-value">Asia/Shanghai</span>
<span class="token comment"># å¸¸ç”¨jdbcå‚æ•°</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/wings_example\\
  ?autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true\\
  &amp;useUnicode=true&amp;characterEncoding=UTF-8\\
  &amp;connectionTimeZone=Asia/Shanghai</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼•å‘é—®é¢˜çš„åŸå› ï¼Œç›®å‰æ–­å®šä¸ºjdbcå’Œtimestampå†å²é—®é¢˜ï¼ˆwings210åç»Ÿä¸€mysql8ï¼Œå·²ç»Ÿä¸€è§£å†³ï¼‰</p><ul><li>jooq - ä½¿ç”¨timestampä½œä¸ºlocalDatetimeçš„å€¼ï¼Œè®¾ç½®preparedStatement</li><li>jdbc - setTimestamp(int parameterIndex, Timestamp x), the JDBC driver uses the time zone of the virtual machine to calculate the date and time of the timestamp in that time zone.</li></ul><p>é€šè¿‡ä»¥ä¸‹SQLå¯ä»¥åœ¨mysqlç«¯è°ƒæŸ¥æ•°æ®åº“æ‰§è¡Œè¿‡ç¨‹</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- æŸ¥çœ‹ ç³»ç»Ÿï¼Œç¨‹åºï¼Œä¼šè¯æ—¶åŒº</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@system_time_zone</span><span class="token punctuation">,</span>  @<span class="token variable">@global.time_zone</span><span class="token punctuation">,</span> @<span class="token variable">@session.time_zone</span><span class="token punctuation">;</span>
<span class="token comment">-- @@system_time_zone, @@global.time_zone, @@session.time_zone</span>
<span class="token comment">-- UTC, Asia/Shanghai, Asia/Shanghai</span>

<span class="token comment">-- mysql æ‰§è¡Œæ—¥å¿—(UTC)</span>
<span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>win_user<span class="token punctuation">\`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">\`</span>delete_dt<span class="token punctuation">\`</span></span> <span class="token operator">&lt;=</span> <span class="token string">&#39;0999-12-31 16:00:00.0&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- jooq ç»‘å®šæ—¥å¿—(GMT+8)</span>
<span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">\`</span>win_user<span class="token punctuation">\`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">\`</span>delete_dt<span class="token punctuation">\`</span></span> <span class="token operator">&lt;=</span> <span class="token string">&#39;1000-01-01 00:00:00.0&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- æ‰“å¼€ï¼Œæ—¥å¿—ï¼Œargumentæ˜¯blobç±»å‹</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_output <span class="token operator">=</span> <span class="token string">&#39;TABLE&#39;</span><span class="token punctuation">;</span><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log <span class="token operator">=</span> <span class="token string">&#39;ON&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>general_log <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_time <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment">-- å…³é—­ï¼Œæ¸…é™¤</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_output <span class="token operator">=</span> <span class="token string">&#39;TABLE&#39;</span><span class="token punctuation">;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> general_log <span class="token operator">=</span> <span class="token string">&#39;OFF&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">truncate</span> <span class="token keyword">table</span> mysql<span class="token punctuation">.</span>general_log<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The session time zone setting affects display and storage of time values that are zone-sensitive. This includes the values displayed by functions such as NOW() or CURTIME(), and values stored in and retrieved from TIMESTAMP columns. Values for TIMESTAMP columns are converted from the session time zone to UTC for storage, and from UTC to the session time zone for retrieval.</p><p>åœ¨mysqlä¸­ï¼Œå°½é‡ä½¿ç”¨NOW(fsp)ï¼Œå› ä¸ºå…¶çŸ­å°æ˜ç¡®æœ‰ç¼“å­˜ï¼Œå¦‚æ— å¿…é¡»ä¸å¯ä½¿ç”¨SYSDATE(fsp)ï¼Œå‚è€ƒ</p>`,16),d={href:"https://dev.mysql.com/doc/refman/8.0/en/time-zone-support.html#time-zone-variables",target:"_blank",rel:"noopener noreferrer"},m={href:"https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_now",target:"_blank",rel:"noopener noreferrer"},u={href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-datetime-types-processing.html",target:"_blank",rel:"noopener noreferrer"},h=o('<h2 id="_2h-2-æ•°æ®åº“å’Œjvmæ—¶åŒº" tabindex="-1"><a class="header-anchor" href="#_2h-2-æ•°æ®åº“å’Œjvmæ—¶åŒº" aria-hidden="true">#</a> 2H.2.æ•°æ®åº“å’ŒJvmæ—¶åŒº</h2><p>å¸¸ç”¨çš„æ—¶åŒºæœ‰2ä¸­æ ¼å¼ï¼Œä¸ç®¡é‚£ç§ï¼Œéƒ½æ¨èä½¿ç”¨ç¨³å®šæ—¶åŒºï¼Œå¦‚æ”¿ç­–ä¸ä¼šå˜ï¼Œæ²¡æœ‰å¤ä»¤æ—¶ã€‚</p><ul><li>å®¹æ˜“ç†è§£çš„ZoneIdå½¢å¼ - åœ°ç†åŸå¸‚ <code>Asia/Shanghai</code>ï¼Œ<code>America/New_York</code></li><li>è§„åˆ™ç¨³å®šçš„Offsetå½¢å¼ - ç›¸å¯¹äºUTCçš„æ—¶å·®ï¼Œ<code>UTC</code>ï¼Œ<code>+08:00</code></li></ul><p>wingsä¸­ä½¿ç”¨DatabaseCheckeræ£€æŸ¥ä»¥ä¸‹â‘¡â‘¢â‘£æ—¶å·®æ˜¯å¦ä¸€è‡´ï¼Œæ¨èå…¨éƒ¨ä¸€è‡´ã€‚</p><ul><li>â‘ system_time_zone - mysql host machine</li><li>â‘¡time_zone - mysql current time zone</li><li>â‘¢connectionTimeZone - jdbc connectionTimeZone/serverTimezone</li><li>â‘£jvm TimeZone - jvm DefaultTimeZone</li><li>â‘¤host TimeZone - java host machine</li></ul><p>å…¶ä¸­â‘¢æ˜¯jdbcä¸­ç‰¹æœ‰çš„ï¼Œå’Œsession timezoneç±»ä¼¼ï¼Œä½†æ¯”<code>SET time_zone = timezone</code>å¼ºå¤§ã€‚ è‹¥â‘¢â‘£ä¸€è‡´åˆ™ä¸å½±å“ä½¿ç”¨ï¼Œä½†è‹¥éwingsç¯å¢ƒï¼Œåœ¨æœªè®¾ç½®â‘¢å¯¼è‡´mysqlé»˜è®¤ä½¿ç”¨â‘¡æ—¶ï¼Œå°±ä¼šå‡ºç°æ—¶å·®é—®é¢˜ã€‚</p><p>ä½¿ç”¨NOW()åŠTIMESTAMPç±»å‹æ—¶è¦æ³¨æ„æ—¶åŒºï¼Œä»–ä»¬å—â‘¢çš„å½±å“ã€‚</p><blockquote><p>The session time zone setting affects display and storage of time values that are zone-sensitive. This includes the values displayed by functions such as NOW() or CURTIME(), and values stored in and retrieved from TIMESTAMP columns. Values for TIMESTAMP columns are converted from the session time zone to UTC for storage, and from UTC to the session time zone for retrieval.</p></blockquote><p>å°½é‡ä½¿ç”¨ DATE, TIME, DATETIMEç±»å‹ï¼Œä»–ä»¬æ˜¯æ—¶åŒºæ— å…³çš„ã€‚</p><blockquote><p>The session time zone setting does not affect values displayed by functions such as UTC_TIMESTAMP() or values in DATE, TIME, or DATETIME columns. Nor are values in those data types stored in UTC; the time zone applies for them only when converting from TIMESTAMP values. If you want locale-specific arithmetic for DATE, TIME, or DATETIME values, convert them to UTC, perform the arithmetic, and then convert back.</p></blockquote><p>ä»¥ä¸Šæ˜¯æ•°æ®åº“å±‚é¢éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œè€Œä»¥ä¸‹ä¸ºjdbcåŠjavaä½“ç³»ä¸­çš„æ³¨æ„ç‚¹ï¼Œ</p><ul><li>connectionTimeZoneå’ŒforceConnectionTimeZoneToSessionåŒæ—¶ä½¿ç”¨</li><li>connectionTimeZoneçš„å€¼ï¼Œå»ºè®®ä½¿ç”¨offsetå½¢å¼ï¼Œ<code>UTC</code>, <code>-40:00</code>, <code>+80:00</code></li><li>åœ¨jdbc urlä¸­ï¼Œéœ€è¦è½¬ä¹‰<code>+</code>ï¼Œä»¥<code>%2B08:00</code>è¡¨ç¤º<code>+80:00</code></li><li>ä¸šåŠ¡ä¾§å»ºè®®ä½¿ç”¨ZoneIdå½¢å¼ï¼Œmysqlé…ç½®é¡¹ï¼Œå»ºè®®æ˜¯æœ‰offsetå½¢å¼</li></ul><p>connectionTimeZoneå‚æ•°ï¼ˆ8.0ä¹‹å‰æ˜¯serverTimezoneï¼‰å¯ä»¥åè°ƒå¥½jvmå’Œmysqlçš„æ—¶åŒºï¼Œ å•ç‹¬ä½¿ç”¨connectionTimeZoneï¼Œä¸ä¼šæ”¹å˜sessionçº§çš„time_zoneï¼Œ éœ€è¦é…åˆforceConnectionTimeZoneToSessionï¼Œæ‰èƒ½è¾¾åˆ°sessionå’Œjdbcä¸€è‡´çš„æ•ˆæœã€‚</p><p>å°½ç®¡ä»¥ä¸Šè®¾ç½®å¯ä»¥æ»¡è¶³é¡¹ç›®è¦æ±‚ï¼Œä½†å› ä½œç”¨èŒƒå›´ä¸å¦‚ç»Ÿä¸€æ—¶åŒºæ›´ç¨³å®šå¯é ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ç»Ÿä¸€æ—¶åŒºã€‚ æ­¤å¤–åœ¨mysqlé…ç½®ä¸­ï¼Œå»ºè®®ä½¿ç”¨offsetæ ¼å¼æ—¶åŒºï¼Œè€Œä¸šåŠ¡ä¾§ä½¿ç”¨ZoneIdæ ¼å¼ã€‚</p><p>åœ¨é…ç½®JdbcUrlæ—¶ï¼Œè‹¥ä½¿ç”¨<code>+</code>æ—¶ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œä¼šå‘ç”ŸDateTimeExceptionï¼Œå› ä¸ºåœ¨URLä¸­<code>+</code>æ ‡è¯†ç©ºæ ¼ã€‚ éœ€è¦è½¬ä¹‰ä¸º<code>%2B</code>ï¼Œå³æ­£ç¡®çš„æ ¼å¼ä¸ºconnectionTimeZone=%2B08:00</p><blockquote><p>wings?connectionTimeZone=+08:00 Invalid ID for region-based ZoneId, invalid format: 08:00</p></blockquote>',16);function v(f,T){const n=i("ExternalLinkIcon");return c(),l("div",null,[r,e("ul",null,[e("li",null,[e("a",d,[s("https://dev.mysql.com/doc/refman/8.0/en/time-zone-support.html#time-zone-variables"),a(n)])]),e("li",null,[e("a",m,[s("https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_now"),a(n)])]),e("li",null,[e("a",u,[s("https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html"),a(n)])]),e("li",null,[e("a",k,[s("https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-datetime-types-processing.html"),a(n)])])]),h])}const g=t(p,[["render",v],["__file","2h-time-zone.html.vue"]]);export{g as default};
